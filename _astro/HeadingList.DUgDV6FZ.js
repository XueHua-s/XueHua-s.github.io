import{r as m}from"./index.vDeobAm6.js";import{j as h}from"./jsx-runtime.D_zvdyIk.js";import{c as L}from"./utils.BEHD0UYf.js";function H(e){const n=[],t=[];return e.forEach(r=>{const o={...r,children:[]};for(;t.length>0&&t[t.length-1].level>=o.level;)t.pop();if(t.length===0)n.push(o);else{const i=t[t.length-1];i.children.push(o),o.parent=i}t.push(o)}),n}function A(){if(typeof document>"u")return[];const e=document.querySelector(".custom-content")??document.querySelector("article");if(!e)return[];const n=Array.from(e.querySelectorAll("h1, h2, h3, h4, h5, h6")).filter(r=>!r.closest(".link-preview-block"));if(n.length===0)return[];const t=n.map((r,o)=>{let i=r.id;return i||(i=(r.textContent||"").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim()||`heading-${o}`,r.id=i),{id:i,text:r.textContent||"",level:parseInt(r.tagName.substring(1))}});return H(t)}function C(e){if(typeof document>"u")return()=>{};const n=document.querySelector(".custom-content")??document.querySelector("article")??document.body,t=n?new MutationObserver(()=>{e()}):null;return n&&t&&t.observe(n,{childList:!0,subtree:!0}),document.addEventListener("astro:page-load",e),document.addEventListener("astro:after-swap",e),requestAnimationFrame(e),()=>{t?.disconnect(),document.removeEventListener("astro:page-load",e),document.removeEventListener("astro:after-swap",e)}}function P(){return m.useSyncExternalStore(C,A,()=>[])}function v(e,n){for(const t of e){if(t.id===n)return t;const r=v(t.children,n);if(r)return r}return null}function y(e){const n=[];let t=e.parent;for(;t;)n.push(t.id),t=t.parent;return n}function I(e,n){const t=[];return e.parent?e.parent.children.forEach(r=>{r.id!==e.id&&r.children.length>0&&t.push(r.id)}):n.forEach(r=>{r.id!==e.id&&r.children.length>0&&t.push(r.id)}),t}function N(e){let n="";const t=new Set;let r=null;const o=new Map,i=()=>{t.forEach(c=>c())},u=()=>{if(o.size===0)return;let c="",l=Number.POSITIVE_INFINITY;o.forEach((a,d)=>{a<l&&(l=a,c=d)}),n!==c&&(n=c,i())},p=()=>{r&&r.disconnect(),o.clear();const c=`-${e}px 0px -70% 0px`;r=new IntersectionObserver(a=>{for(const d of a){const f=d.target.id;f&&(d.isIntersecting?o.set(f,d.boundingClientRect.top):o.delete(f))}u()},{rootMargin:c,threshold:0});const l=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");l.forEach(a=>{r?.observe(a)}),l.length>0&&o.size===0&&requestAnimationFrame(()=>{const a=Array.from(l);for(let d=a.length-1;d>=0;d--){const f=a[d];if(f.getBoundingClientRect().top<e&&f.id){n!==f.id&&(n=f.id,i());break}}})},s=()=>{n="",o.clear(),requestAnimationFrame(()=>{p()})};return{subscribe:c=>(t.size===0&&(p(),document.addEventListener("astro:page-load",s)),t.add(c),()=>{t.delete(c),t.size===0&&(r&&(r.disconnect(),r=null),document.removeEventListener("astro:page-load",s),o.clear())}),getSnapshot:()=>n,getServerSnapshot:()=>""}}function R({offsetTop:e=120}={}){const n=m.useMemo(()=>N(e),[e]);return m.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getServerSnapshot)}function z({headings:e,activeId:n,defaultExpanded:t=!1}){const[r,o]=m.useState(()=>{if(t){let s=function(l){l.forEach(a=>{a.children.length>0&&c.add(a.id),s(a.children)})};const c=new Set;return s(e),c}return new Set}),i=m.useMemo(()=>{const s=new Set(r);if(!n||e.length===0)return s;const c=v(e,n);if(!c)return s;const a=[...y(c)];if(c.children.length>0&&a.unshift(n),a.length===0)return s;const d={};return a.forEach(f=>{const g=v(e,f);g&&(d[g.level]||(d[g.level]=[]),d[g.level].push(f))}),Object.keys(d).forEach(f=>{const g=parseInt(f);d[g].forEach(E=>{const b=v(e,E);b&&(I(b,e).forEach(w=>s.delete(w)),s.add(E))})}),s},[n,e,r]),u=m.useCallback(s=>i.has(s),[i]),p=m.useCallback(s=>{o(c=>{const l=new Set(c);return l.has(s)?l.delete(s):l.add(s),l})},[]);return{expandedIds:i,isExpanded:u,toggleExpanded:p,setExpandedIds:o}}function _({headings:e,setExpandedIds:n}){return m.useCallback(t=>{const r=document.getElementById(t);if(!r)return;r.scrollIntoView({behavior:"smooth",block:"start"});const o=v(e,t);if(!o)return;const i=y(o);o.children.length>0&&i.unshift(t),i.length!==0&&n(u=>{const p=new Set(u),s={};return i.forEach(c=>{const l=v(e,c);l&&(s[l.level]||(s[l.level]=[]),s[l.level].push(c))}),Object.keys(s).forEach(c=>{const l=parseInt(c,10);s[l].forEach(d=>{const f=v(e,d);f&&(I(f,e).forEach(x=>p.delete(x)),p.add(d))})}),p})},[e,n])}const j=.75,k=1,q=({heading:e,depth:n=0,isActive:t=!1,isExpanded:r=!1,onHeadingClick:o,renderChildren:i})=>{const u=e.children.length>0;return h.jsxs("div",{className:"heading-tree-item relative",children:[h.jsxs("a",{href:`#${e.id}`,onClick:p=>{p.preventDefault(),o(e.id)},className:L("heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2",{"bg-primary/10 text-primary border-l-primary hover:text-primary hover:bg-primary/10 font-medium":t}),style:{paddingLeft:`${j+n*k}rem`,paddingRight:u?"0.5rem":"0.75rem"},"data-level":e.level,"aria-label":e.text,"aria-current":t?"location":void 0,children:[h.jsx("span",{className:"heading-text block flex-1 truncate leading-relaxed",children:e.text}),t&&h.jsx("span",{className:"text-primary ml-2 text-xs",children:"â€¢"})]}),u&&r&&i&&h.jsx("div",{className:"heading-children",children:i(e.children,n+1)})]},e.id)},S=m.memo(q),T=({headings:e,depth:n=0,activeId:t,expandedIds:r,onHeadingClick:o})=>{const i=(u,p)=>u.map(s=>h.jsx(S,{heading:s,depth:p,isActive:t===s.id,isExpanded:r.has(s.id),onHeadingClick:o,renderChildren:i},s.id));return h.jsx(h.Fragment,{children:e.map(u=>h.jsx(S,{heading:u,depth:n,isActive:t===u.id,isExpanded:r.has(u.id),onHeadingClick:o,renderChildren:i},u.id))})},$=m.memo(T);export{$ as H,R as a,z as b,_ as c,P as u};

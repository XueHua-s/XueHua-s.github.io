import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{R as C,r as u}from"./index.vDeobAm6.js";import{u as D}from"./index.D8A-VS5Y.js";import{a as A}from"./index.BSdFiPHn.js";import{u as M,a as q,b as V,c as z,H as P,d as W,e as Y}from"./blogLayoutConfig.a_IA607M.js";import{c as o}from"./utils.BEHD0UYf.js";import{m as O}from"./proxy.k8ZnVpfL.js";import{A as B,R as H}from"./router.hwxBaD47.js";import{b as U,d as G,e as K,f as X,g as J,h as Q,i as Z,c as ee}from"./index.BCmbW2ws.js";import{_ as te}from"./preload-helper.BlTxHScW.js";import"./_commonjsHelpers.CqkleIqs.js";var I=(t=>(t.HOME="home",t.POST="post",t.NONE="none",t))(I||{}),g=(t=>(t.INFO="info",t.DIRECTORY="directory",t.SERIES="series",t))(g||{});const E=A(g.INFO);A(I.HOME);const se=120;function re({defaultExpanded:t=!1,enableNumbering:s=!0,sourceHeadings:r}={}){const a=M(r),n=q({offsetTop:se}),{expandedIds:i,setExpandedIds:d}=V({headings:a,activeId:n,defaultExpanded:t}),c=z({headings:a,setExpandedIds:d});return a.length===0?null:e.jsx("nav",{className:`toc-container max-h-[90dvh] overflow-auto ${s?"":"toc-no-numbering"}`,"aria-label":"文章目录",children:e.jsx("div",{className:"space-y-1 pr-2",children:e.jsx(P,{headings:a,depth:0,activeId:n,expandedIds:i,onHeadingClick:c})})})}const _=({options:t,defaultValue:s,onChange:r,className:a,id:n,indicateClass:i,itemClass:d,value:c})=>{const[y,m]=u.useState(()=>c??s??t[0]?.value??""),f=W(),h=u.useCallback(l=>{c===void 0&&m(l),r?.(l)},[r,c]),v=c??y,S=u.useCallback(l=>v===l,[v]);return e.jsx("div",{className:o("bg-muted flex w-fit cursor-pointer rounded-sm p-1 text-xs font-semibold backdrop-blur-lg select-none",a),children:t.map(l=>{if(!l)return null;const{label:x,value:p,icon:N}=l,b=S(p);return e.jsxs(O.div,{className:o("flex-center relative cursor-pointer gap-1.5 px-3 py-1 first:rounded-l-xs last:rounded-r-xs",{"text-primary-foreground":b},{"opacity-50":!b},d),onClick:()=>h(p),layout:!f,transition:f?{duration:0}:{type:"spring",stiffness:400,damping:30},children:[N&&e.jsx("span",{className:"flex-center shrink-0",children:C.createElement(N,{className:"w-4 h-4"})}),e.jsx(B,{initial:!1,mode:"wait",children:b&&x&&e.jsx(O.span,{initial:f?void 0:{width:0,opacity:0},animate:{width:"auto",opacity:1},exit:f?void 0:{width:0,opacity:0},transition:f?{duration:0}:{width:{duration:.2,ease:"easeInOut"},opacity:{duration:.15,ease:"easeInOut"}},className:"overflow-hidden whitespace-nowrap",children:x})}),b&&e.jsx(O.div,{layoutId:`segmented_selected_bg_${n??"default"}`,className:o("bg-gradient-shoka-button absolute inset-0 -z-10 rounded-sm",i),transition:f?{duration:0}:{type:"spring",stiffness:400,damping:30},style:{willChange:f?"auto":"transform"}})]},p)})})};C.memo(_);const F=({className:t,...s})=>{const r=[{label:"站点概览",value:g.INFO,icon:U},{label:"文章目录",value:g.DIRECTORY,icon:G},{label:"系列文章",value:g.SERIES,icon:K}];return e.jsx(_,{...s,options:r,className:o("flex w-fit cursor-pointer rounded-sm bg-black/8 p-1 text-xs font-semibold backdrop-blur-lg select-none",t),onChange:a=>E.set(a)})};F.displayName="HomeSiderSegmented";const ae=C.memo(F);function ne({posts:t,currentPostSlug:s,className:r}){return t?.length?e.jsx("div",{className:o("flex flex-col gap-1",r),children:t.map(({post:a,href:n})=>{const i=a.data.link??a.id,d=i===s;return e.jsxs("a",{href:n,className:o("group relative flex items-start gap-3 rounded-md px-1 py-2 transition-colors","hover:bg-accent/50",d&&"text-primary font-medium"),children:[e.jsx("span",{className:o("mt-2 h-2 w-2 shrink-0 rounded-full transition-colors",d?"bg-primary":"bg-muted-foreground/40 group-hover:bg-muted-foreground/60")}),e.jsx("span",{className:o("line-clamp-2 flex-1 text-sm leading-relaxed transition-colors",d?"text-primary":"text-foreground group-hover:text-primary"),children:a.data.title})]},i)})}):e.jsx("div",{className:"text-muted-foreground py-8 text-center text-sm",children:"暂无系列文章"})}function oe({prevPost:t,nextPost:s,className:r}){if(!t&&!s)return null;const a="smooth";return e.jsxs("div",{className:o("border-border mt-4 flex flex-col gap-3 border-t pt-4 md:mt-0 md:pt-2",r),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t?e.jsxs("a",{href:t.href,className:o("group flex items-center gap-1.5 rounded-md px-2 py-1.5 transition-colors","hover:bg-accent text-muted-foreground hover:text-primary","max-w-[45%] min-w-0 flex-1"),title:t.post.data.title,suppressHydrationWarning:!0,children:[e.jsx(X,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"truncate text-xs",children:t.post.data.title})]}):e.jsx("div",{className:"max-w-[45%] flex-1"}),s?e.jsxs("a",{href:s.href,className:o("group flex items-center gap-1.5 rounded-md px-2 py-1.5 transition-colors","hover:bg-accent text-muted-foreground hover:text-primary","max-w-[45%] min-w-0 flex-1 justify-end text-right"),title:s.post.data.title,suppressHydrationWarning:!0,children:[e.jsx("span",{className:"truncate text-xs",children:s.post.data.title}),e.jsx(J,{className:"h-4 w-4 shrink-0"})]}):e.jsx("div",{className:"max-w-[45%] flex-1"})]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:a}),className:o("flex items-center justify-center gap-1.5 rounded-md px-3 py-1.5 transition-colors","hover:bg-accent text-muted-foreground hover:text-primary text-xs"),title:"回到顶部","aria-label":"回到顶部",suppressHydrationWarning:!0,children:[e.jsx(Q,{className:"h-4 w-4"}),"回到顶部"]}),e.jsxs("button",{onClick:()=>window.scrollTo({top:document.body.scrollHeight,behavior:a}),className:o("flex items-center justify-center gap-1.5 rounded-md px-3 py-1.5 transition-colors","hover:bg-accent text-muted-foreground hover:text-primary text-xs"),title:"滚到底部","aria-label":"滚到底部",suppressHydrationWarning:!0,children:[e.jsx(Z,{className:"h-4 w-4"}),"滚到底部"]})]})]})}function ie({className:t}){const s=u.useRef(null);return u.useEffect(()=>{let r=null;const a=()=>{const i=s.current;if(!i)return;const d=document.documentElement.scrollHeight-window.innerHeight,c=d>0?window.scrollY/d:0;i.style.transform=`scaleX(${c})`,r=null},n=()=>{r===null&&(r=window.requestAnimationFrame(a))};return a(),window.addEventListener("scroll",n,{passive:!0}),window.addEventListener("resize",n),()=>{r!==null&&window.cancelAnimationFrame(r),window.removeEventListener("scroll",n),window.removeEventListener("resize",n)}},[]),e.jsx("div",{className:t,children:e.jsx("div",{ref:s,className:"bg-primary h-1 origin-left rounded-full scale-x-0"})})}let T={};try{T=(await te(()=>import("./lqips.C8l0-4M6.js"),[])).default}catch{}function le(t){return t.replace(/^\/img\//,"")}function de(t){const s=le(t),r=T[s];if(r?.length!==18)return;const a=`#${r.slice(0,6)}`,n=`#${r.slice(6,12)}`,i=`#${r.slice(12,18)}`;return`linear-gradient(135deg, ${a} 0%, ${n} 50%, ${i} 100%)`}const ce=ee("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm ring-offset-background transition-colors focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline","gradient-shoka":"bg-gradient-shoka-button text-primary-foreground",unstyle:""},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});function $({url:t,label:s,variant:r,size:a,className:n,children:i,...d}){const c=t?"a":"button",y=t?{href:t,"aria-label":s}:{type:"button"};return e.jsx(c,{...y,className:o(ce({variant:r,size:a}),n),...d,children:i})}function ue(){return e.jsx("div",{className:"mt-2 grid grid-cols-3 gap-2",children:Object.entries(Y).map(([t,s])=>{const{url:r,label:a,iconClass:n,color:i}=s;return e.jsx("div",{children:e.jsxs("a",{className:o("social-link flex-center group relative overflow-hidden rounded-xl px-1.5 py-1 transition-all duration-300 group-hover:scale-105"),style:i?{"--link-color":i}:void 0,"data-platform":t,href:r,title:a,"data-tooltip-interactive":"false","data-tooltip-placement":"top","aria-label":a,children:[n&&e.jsx("i",{className:`${n} social-icon`,"aria-hidden":"true"}),e.jsx("span",{className:"absolute inset-0 -z-10 -translate-x-full translate-y-full rounded-xl transition-transform duration-300 group-hover:translate-x-0 group-hover:translate-y-0"})]})},t)})})}function me({avatar:t,name:s,description:r,postCount:a,categoryCount:n,tagCount:i,routes:d,currentPath:c,className:y}){const m=u.useId(),[f,h]=u.useState({}),v=u.useMemo(()=>de(t),[t]),S=l=>{h(x=>({...x,[l]:!x[l]}))};return e.jsxs("div",{className:o("flex flex-col items-center",y),children:[e.jsx("div",{className:"h-40 w-40 rounded-full",style:v?{backgroundImage:v}:void 0,children:e.jsx("img",{className:"shadow-card-darker hover:animate-shake h-full w-full rounded-full transition",src:t,alt:`${s??""} avatar`,loading:"eager",fetchPriority:"high"})}),e.jsx("p",{className:"mt-2",children:s}),e.jsx("p",{className:"text-muted-foreground mt-3 text-center",children:r}),e.jsx(ue,{}),e.jsxs("div",{className:"text-muted-foreground mt-3 flex justify-center text-center text-sm/4 whitespace-nowrap select-none dark:text-white/80",children:[e.jsxs("a",{href:H.Home,className:"hover:text-blue flex cursor-pointer flex-col gap-2 p-1 transition",children:[e.jsx("span",{className:"text-lg/5 font-bold",children:a}),"文章"]}),e.jsx("div",{className:"bg-muted-foreground mx-3 w-px"}),e.jsx("a",{href:H.Categories,"aria-label":"分类",className:"hover:text-blue",children:e.jsxs("p",{className:"flex cursor-pointer flex-col gap-2 p-1 transition",children:[e.jsx("span",{className:"text-lg/5 font-bold",children:n}),"分类"]})}),e.jsx("div",{className:"bg-muted-foreground mx-3 w-px"}),e.jsxs("a",{href:H.Tags,className:"hover:text-blue flex cursor-pointer flex-col gap-2 p-1 transition",children:[e.jsx("span",{className:"text-lg/5 font-bold",children:i}),"标签"]})]}),e.jsx("div",{className:"mt-6 flex w-full flex-col items-center gap-2.5",children:d.map(({name:l,path:x,icon:p,children:N},b)=>{if(N?.length){const w=`${m}-collapse-${b}`,k=!!f[w];return e.jsxs("div",{className:"bg-foreground/10 flex w-40 flex-col rounded-xl opacity-75 transition-all duration-300 hover:opacity-100","data-collapsible":!0,children:[e.jsxs("button",{className:"flex-center hover:bg-foreground/5 h-12 w-full cursor-pointer rounded-xl transition-colors","aria-expanded":k,"aria-controls":w,"aria-label":`${l}菜单`,type:"button",onClick:()=>S(w),children:[p&&e.jsx("i",{className:`mr-1.5 ${p}`,"aria-hidden":"true"}),l,e.jsx("i",{className:o("fa-solid fa-caret-down ml-2 text-base transition-transform duration-300",k&&"rotate-180"),"aria-hidden":"true"})]}),e.jsx("div",{id:w,className:o("collapse-content",!k&&"collapse-hidden"),"data-collapse-content":!0,children:e.jsx("div",{className:"flex flex-col items-center",children:N.map(({name:j,path:R,icon:L})=>e.jsxs($,{url:R,label:j,variant:"gradient-shoka",className:o("shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider",{"text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none":R!==c}),children:[L&&e.jsx("i",{className:`mr-1.5 ${L}`,"aria-hidden":"true"}),j]},R))})})]},w)}return e.jsxs($,{url:x,label:l,variant:"gradient-shoka",className:o("shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100",{"text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none":x!==c}),children:[p&&e.jsx("i",{className:`mr-1.5 ${p}`,"aria-hidden":"true"}),l]},x)})})]})}const xe=200;function ke({type:t,defaultSegmentType:s,homeInfo:r,tocHeadings:a,tocNumbering:n=!0,seriesPostItems:i=[],currentPostSlug:d,prevPostItem:c,nextPostItem:y}){const m=t===I.POST,f=D(E),h=m?f:g.INFO,[v,S]=u.useState(h),[l,x]=u.useState(null),[p,N]=u.useState(null),b=u.useRef(!0);u.useEffect(()=>{m?E.set(s):E.set(g.INFO)},[s,m]),u.useEffect(()=>{if(b.current){S(h),b.current=!1;return}if(h===v)return;N(v),S(h),x(h);const j=window.setTimeout(()=>{N(null),x(null)},xe);return()=>{window.clearTimeout(j)}},[v,h]);const w=j=>o("sider-slot",{hidden:j!==v&&j!==p,entering:j===l,exiting:j===p}),k=u.useMemo(()=>m?s:g.INFO,[s,m]);return e.jsxs(e.Fragment,{children:[m&&e.jsx(ae,{className:"my-4 flex w-full justify-between text-sm/6",itemClass:"grow",defaultValue:k,id:"inner-home-sider"}),e.jsxs("div",{className:"vertical-scrollbar scroll-gutter-stable relative block w-full flex-1 overflow-x-hidden overflow-y-auto md:pt-4 md:pl-3","data-type":t,"data-default-type":k,children:[e.jsx("div",{className:w(g.INFO),"data-slot-type":"info",children:e.jsx(me,{className:t===I.HOME?"pt-18 md:pt-0":"",...r})}),e.jsx("div",{className:w(g.DIRECTORY),"data-slot-type":"directory",children:m&&e.jsx(re,{enableNumbering:n,sourceHeadings:a})}),e.jsx("div",{className:w(g.SERIES),"data-slot-type":"series",children:m&&e.jsx(ne,{posts:i,currentPostSlug:d})})]}),m&&e.jsx(oe,{prevPost:c??null,nextPost:y??null,className:"w-full px-2"}),e.jsx(ie,{className:"mt-auto w-full rounded-full pt-4 sticky bottom-0"})]})}export{ke as default};

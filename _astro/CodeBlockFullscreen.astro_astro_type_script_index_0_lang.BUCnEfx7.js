import{b as r,e as u,f as m}from"./ui.CKI2j8mQ.js";import{c as y}from"./code-block-enhancer.B27gCbhN.js";import"./index.BSdFiPHn.js";const f={overlay:"code-fullscreen-overlay",dialog:"code-fullscreen-dialog",content:"code-fullscreen-content",closeBtn:"code-fullscreen-close",copyBtn:"code-fullscreen-copy",copyIcon:"code-fullscreen-copy-icon",checkIcon:"code-fullscreen-check-icon",copyText:"code-fullscreen-copy-text",language:"code-fullscreen-language",pre:"code-fullscreen-pre",code:"code-fullscreen-code"},o={opacityFull:"opacity-100",opacityZero:"opacity-0",copied:"text-primary",hidden:"hidden"},l={open:"open",closed:"closed"};function v(d,e){if(!e)return;e.split(";").filter(t=>t.trim()).forEach(t=>{const n=t.indexOf(":");if(n===-1)return;const i=t.slice(0,n).trim(),c=t.slice(n+1).trim();!i||!c||d.style.setProperty(i,c)})}class L{elements;unsubscribe=null;currentData=null;copyTimeoutId=null;constructor(){this.elements=this.initElements(),this.validateElements()&&(this.bindEvents(),this.subscribeToStore(),this.listenToCustomEvent())}initElements(){return Object.entries(f).reduce((e,[s,t])=>({...e,[s]:document.getElementById(t)}),{})}validateElements(){return Object.entries(this.elements).every(([e,s])=>{const t=!!s;return t||console.error(`代码全屏元素未找到: ${e}`),t})}bindEvents(){document.addEventListener("keydown",this.handleKeyDown),this.elements.closeBtn?.addEventListener("click",this.handleClose),this.elements.dialog?.addEventListener("click",this.handleBackgroundClick),this.elements.copyBtn?.addEventListener("click",this.handleCopy)}handleBackgroundClick=e=>{e.target===this.elements.dialog&&r()};subscribeToStore(){this.unsubscribe=u.subscribe(e=>{e?(this.currentData=e,this.open(e)):this.close()})}listenToCustomEvent(){window.addEventListener("open-code-fullscreen",(e=>{m(e.detail)}))}handleKeyDown=e=>{e.key==="Escape"&&u.get()&&r()};handleClose=()=>{r()};handleCopy=async()=>{if(!this.currentData)return;await y(this.currentData.code)&&this.showCopiedState()};showCopiedState(){const{copyBtn:e,copyIcon:s,checkIcon:t,copyText:n}=this.elements;!e||!s||!t||!n||(this.copyTimeoutId&&clearTimeout(this.copyTimeoutId),s.classList.add(o.hidden),t.classList.remove(o.hidden),e.classList.add(o.copied),n.textContent="已复制",this.copyTimeoutId=setTimeout(()=>{s.classList.remove(o.hidden),t.classList.add(o.hidden),e.classList.remove(o.copied),n.textContent="复制",this.copyTimeoutId=null},2e3))}open(e){const{overlay:s,dialog:t,content:n,language:i,pre:c,code:a}=this.elements;!s||!t||!n||!i||!c||!a||(i.textContent=e.language,c.className=e.preClassName+" p-4",c.removeAttribute("style"),v(c,e.preStyle),a.className=e.codeClassName,a.innerHTML=e.codeHTML,s.dataset.state=l.open,t.dataset.state=l.open,document.body.style.overflow="hidden",requestAnimationFrame(()=>{s.classList.remove(o.opacityZero),s.classList.add(o.opacityFull),n.classList.remove(o.opacityZero),n.classList.add(o.opacityFull)}))}close(){const{overlay:e,dialog:s,content:t}=this.elements;!e||!s||!t||(e.classList.remove(o.opacityFull),e.classList.add(o.opacityZero),t.classList.remove(o.opacityFull),t.classList.add(o.opacityZero),setTimeout(()=>{e.dataset.state=l.closed,s.dataset.state=l.closed,document.body.style.overflow=""},200),this.currentData=null)}destroy(){document.removeEventListener("keydown",this.handleKeyDown),this.elements.closeBtn?.removeEventListener("click",this.handleClose),this.elements.dialog?.removeEventListener("click",this.handleBackgroundClick),this.elements.copyBtn?.removeEventListener("click",this.handleCopy),this.copyTimeoutId&&clearTimeout(this.copyTimeoutId),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}}let p=null;function h(){p?.destroy(),p=new L}document.readyState!=="loading"&&h();document.addEventListener("astro:page-load",h);document.addEventListener("astro:before-preparation",()=>{r()});

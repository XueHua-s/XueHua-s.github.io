import{g as o,m as h,h as m}from"./ui.CKI2j8mQ.js";import{c as p}from"./code-block-enhancer.B27gCbhN.js";import"./index.BSdFiPHn.js";const v={overlay:"mermaid-fullscreen-overlay",dialog:"mermaid-fullscreen-dialog",content:"mermaid-fullscreen-content",closeBtn:"mermaid-fullscreen-close",resetBtn:"mermaid-fullscreen-reset",copyBtn:"mermaid-fullscreen-copy",copyIcon:"mermaid-fullscreen-copy-icon",checkIcon:"mermaid-fullscreen-check-icon",copyText:"mermaid-fullscreen-copy-text",viewport:"mermaid-fullscreen-viewport",svgContainer:"mermaid-fullscreen-svg",zoomLevel:"mermaid-zoom-level"},n={opacityFull:"opacity-100",opacityZero:"opacity-0",copied:"text-primary",hidden:"hidden"},l={open:"open",closed:"closed"};class y{elements;unsubscribe=null;currentData=null;copyTimeoutId=null;scale=1;translateX=0;translateY=0;isDragging=!1;dragStartX=0;dragStartY=0;lastTranslateX=0;lastTranslateY=0;initialPinchDistance=0;initialPinchScale=1;constructor(){this.elements=this.initElements(),this.validateElements()&&(this.bindEvents(),this.subscribeToStore(),this.listenToCustomEvent())}initElements(){return Object.entries(v).reduce((e,[s,t])=>({...e,[s]:document.getElementById(t)}),{})}validateElements(){return Object.entries(this.elements).every(([e,s])=>{const t=!!s;return t||console.error(`Mermaid fullscreen element not found: ${e}`),t})}bindEvents(){document.addEventListener("keydown",this.handleKeyDown),this.elements.closeBtn?.addEventListener("click",this.handleClose),this.elements.dialog?.addEventListener("click",this.handleBackgroundClick),this.elements.copyBtn?.addEventListener("click",this.handleCopy),this.elements.resetBtn?.addEventListener("click",this.handleReset),this.elements.viewport?.addEventListener("wheel",this.handleWheel,{passive:!1}),this.elements.viewport?.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),this.elements.viewport?.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.elements.viewport?.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.elements.viewport?.addEventListener("touchend",this.handleTouchEnd)}handleBackgroundClick=e=>{e.target===this.elements.dialog&&o()};subscribeToStore(){this.unsubscribe=h.subscribe(e=>{e?(this.currentData=e,this.open(e)):this.close()})}listenToCustomEvent(){window.addEventListener("open-mermaid-fullscreen",(e=>{m(e.detail)}))}handleKeyDown=e=>{e.key==="Escape"&&h.get()&&o()};handleClose=()=>{o()};handleReset=()=>{this.scale=1,this.translateX=0,this.translateY=0,this.applyTransform()};handleCopy=async()=>{if(!this.currentData)return;await p(this.currentData.source)&&this.showCopiedState()};showCopiedState(){const{copyBtn:e,copyIcon:s,checkIcon:t,copyText:i}=this.elements;!e||!s||!t||!i||(this.copyTimeoutId&&clearTimeout(this.copyTimeoutId),s.classList.add(n.hidden),t.classList.remove(n.hidden),e.classList.add(n.copied),i.textContent="Copied",this.copyTimeoutId=setTimeout(()=>{s.classList.remove(n.hidden),t.classList.add(n.hidden),e.classList.remove(n.copied),i.textContent="Copy",this.copyTimeoutId=null},2e3))}handleWheel=e=>{e.preventDefault();const s=e.deltaY>0?.9:1.1,t=Math.min(Math.max(.5,this.scale*s),5);if(this.elements.viewport){const i=this.elements.viewport.getBoundingClientRect(),a=e.clientX-i.left-i.width/2,r=e.clientY-i.top-i.height/2,c=t/this.scale;this.translateX=a-(a-this.translateX)*c,this.translateY=r-(r-this.translateY)*c}this.scale=t,this.applyTransform()};handleMouseDown=e=>{e.button===0&&(this.isDragging=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.lastTranslateX=this.translateX,this.lastTranslateY=this.translateY)};handleMouseMove=e=>{this.isDragging&&(this.translateX=this.lastTranslateX+(e.clientX-this.dragStartX),this.translateY=this.lastTranslateY+(e.clientY-this.dragStartY),this.applyTransform())};handleMouseUp=()=>{this.isDragging=!1};handleTouchStart=e=>{e.touches.length===2?(e.preventDefault(),this.initialPinchDistance=this.getDistance(e.touches[0],e.touches[1]),this.initialPinchScale=this.scale):e.touches.length===1&&(this.isDragging=!0,this.dragStartX=e.touches[0].clientX,this.dragStartY=e.touches[0].clientY,this.lastTranslateX=this.translateX,this.lastTranslateY=this.translateY)};handleTouchMove=e=>{if(e.touches.length===2){e.preventDefault();const s=this.getDistance(e.touches[0],e.touches[1]),t=this.initialPinchScale*(s/this.initialPinchDistance);this.scale=Math.min(Math.max(.5,t),5),this.applyTransform()}else e.touches.length===1&&this.isDragging&&(this.translateX=this.lastTranslateX+(e.touches[0].clientX-this.dragStartX),this.translateY=this.lastTranslateY+(e.touches[0].clientY-this.dragStartY),this.applyTransform())};handleTouchEnd=()=>{this.isDragging=!1};getDistance(e,s){const t=e.clientX-s.clientX,i=e.clientY-s.clientY;return Math.sqrt(t*t+i*i)}applyTransform(){this.elements.svgContainer&&(this.elements.svgContainer.style.transform=`translate(${this.translateX}px, ${this.translateY}px) scale(${this.scale})`),this.elements.zoomLevel&&(this.elements.zoomLevel.textContent=`${Math.round(this.scale*100)}%`)}open(e){const{overlay:s,dialog:t,content:i,svgContainer:a}=this.elements;!s||!t||!i||!a||(this.scale=1,this.translateX=0,this.translateY=0,this.applyTransform(),a.innerHTML=e.svg,s.dataset.state=l.open,t.dataset.state=l.open,document.body.style.overflow="hidden",requestAnimationFrame(()=>{s.classList.remove(n.opacityZero),s.classList.add(n.opacityFull),i.classList.remove(n.opacityZero),i.classList.add(n.opacityFull)}))}close(){const{overlay:e,dialog:s,content:t,svgContainer:i}=this.elements;!e||!s||!t||(e.classList.remove(n.opacityFull),e.classList.add(n.opacityZero),t.classList.remove(n.opacityFull),t.classList.add(n.opacityZero),setTimeout(()=>{e.dataset.state=l.closed,s.dataset.state=l.closed,document.body.style.overflow="",i&&(i.innerHTML="")},200),this.currentData=null)}destroy(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.elements.closeBtn?.removeEventListener("click",this.handleClose),this.elements.dialog?.removeEventListener("click",this.handleBackgroundClick),this.elements.copyBtn?.removeEventListener("click",this.handleCopy),this.elements.resetBtn?.removeEventListener("click",this.handleReset),this.copyTimeoutId&&clearTimeout(this.copyTimeoutId),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}}let d=null;function u(){d?.destroy(),d=new y}document.readyState!=="loading"&&u();document.addEventListener("astro:page-load",u);document.addEventListener("astro:before-preparation",()=>{o()});

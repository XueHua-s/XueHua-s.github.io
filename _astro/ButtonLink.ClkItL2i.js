import{j as p}from"./jsx-runtime.D_zvdyIk.js";import{r as u}from"./index.vDeobAm6.js";import{M as G,u as R,P as K,j as U,a as W,L as X,k as Y,l as J,p as Q}from"./proxy.DzZABkkb.js";import{a as j}from"./utils.09jiQjc0.js";import{c as Z}from"./index.CDeUW-aT.js";class ee extends u.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function te({children:e,isPresent:t}){const n=u.useId(),r=u.useRef(null),o=u.useRef({width:0,height:0,top:0,left:0}),{nonce:a}=u.useContext(G);return u.useInsertionEffect(()=>{const{width:l,height:d,top:s,left:i}=o.current;if(t||!r.current||!l||!d)return;r.current.dataset.motionPopId=n;const c=document.createElement("style");return a&&(c.nonce=a),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${d}px !important;
            top: ${s}px !important;
            left: ${i}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[t]),p.jsx(ee,{isPresent:t,childRef:r,sizeRef:o,children:u.cloneElement(e,{ref:r})})}const ne=({children:e,initial:t,isPresent:n,onExitComplete:r,custom:o,presenceAffectsLayout:a,mode:l})=>{const d=R(re),s=u.useId(),i=u.useCallback(f=>{d.set(f,!0);for(const h of d.values())if(!h)return;r&&r()},[d,r]),c=u.useMemo(()=>({id:s,initial:t,isPresent:n,custom:o,onExitComplete:i,register:f=>(d.set(f,!1),()=>d.delete(f))}),a?[Math.random(),i]:[n,i]);return u.useMemo(()=>{d.forEach((f,h)=>d.set(h,!1))},[n]),u.useEffect(()=>{!n&&!d.size&&r&&r()},[n]),l==="popLayout"&&(e=p.jsx(te,{isPresent:n,children:e})),p.jsx(K.Provider,{value:c,children:e})};function re(){return new Map}const k=e=>e.key||"";function M(e){const t=[];return u.Children.forEach(e,n=>{u.isValidElement(n)&&t.push(n)}),t}const ve=({children:e,custom:t,initial:n=!0,onExitComplete:r,presenceAffectsLayout:o=!0,mode:a="sync",propagate:l=!1})=>{const[d,s]=U(l),i=u.useMemo(()=>M(e),[e]),c=l&&!d?[]:i.map(k),f=u.useRef(!0),h=u.useRef(i),m=R(()=>new Map),[v,I]=u.useState(i),[b,w]=u.useState(i);W(()=>{f.current=!1,h.current=i;for(let x=0;x<b.length;x++){const g=k(b[x]);c.includes(g)?m.delete(g):m.get(g)!==!0&&m.set(g,!1)}},[b,c.length,c.join("-")]);const L=[];if(i!==v){let x=[...i];for(let g=0;g<b.length;g++){const E=b[g],H=k(E);c.includes(H)||(x.splice(g,0,E),L.push(E))}a==="wait"&&L.length&&(x=L),w(M(x)),I(i);return}const{forceRender:A}=u.useContext(X);return p.jsx(p.Fragment,{children:b.map(x=>{const g=k(x),E=l&&!d?!1:i===b||c.includes(g),H=()=>{if(m.has(g))m.set(g,!0);else return;let $=!0;m.forEach(V=>{V||($=!1)}),$&&(A?.(),w(h.current),l&&s?.(),r&&r())};return p.jsx(ne,{isPresent:E,initial:!f.current||n?void 0:!1,custom:E?void 0:t,presenceAffectsLayout:o,mode:a,onExitComplete:E?void 0:H,children:x},g)})})};function be(){!Y.current&&J();const[e]=u.useState(Q.current);return e}const N=[];let z=N,P="";const B=e=>e.map(t=>`${t.id}:${t.level}:${t.text}:${B(t.children)}`).join("|"),q=()=>{const e=oe(),t=B(e);return t===P?!1:(P=t,z=e,!0)};function O(e){const t=[],n=[];return e.forEach(r=>{const o={...r,children:[]};for(;n.length>0&&n[n.length-1].level>=o.level;)n.pop();if(n.length===0)t.push(o);else{const a=n[n.length-1];a.children.push(o),o.parent=a}n.push(o)}),t}function se(e){return e?e.map(t=>"depth"in t?{id:t.slug,text:t.text,level:t.depth}:t):[]}function oe(){if(typeof document>"u")return[];const e=document.querySelector(".custom-content")??document.querySelector("article");if(!e)return[];const t=Array.from(e.querySelectorAll("h1, h2, h3, h4, h5, h6")).filter(r=>!r.closest(".link-preview-block"));if(t.length===0)return[];const n=t.map((r,o)=>{let a=r.id;return a||(a=(r.textContent||"").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim()||`heading-${o}`,r.id=a),{id:a,text:r.textContent||"",level:parseInt(r.tagName.substring(1))}});return O(n)}function ie(e){if(typeof document>"u")return()=>{};let t=null,n=null,r=null;const o=()=>{r===null&&(r=requestAnimationFrame(()=>{r=null,q()&&e()}))},a=()=>{t&&t.disconnect();const c=document.querySelector(".custom-content")??document.querySelector("article");c?(t=new MutationObserver(()=>{o()}),t.observe(c,{childList:!0,subtree:!0}),q(),o()):n=requestAnimationFrame(()=>{a()})},l=document.querySelector(".custom-content")??document.querySelector("article"),d=l?l.querySelector("h1, h2, h3, h4, h5, h6"):null;l&&d?a():requestAnimationFrame(()=>{requestAnimationFrame(()=>{a()})});const s=()=>{n&&cancelAnimationFrame(n),requestAnimationFrame(()=>{requestAnimationFrame(()=>{a()})})};document.addEventListener("astro:page-load",s),document.addEventListener("astro:after-swap",s);const i=setTimeout(()=>{o()},100);return()=>{n&&cancelAnimationFrame(n),r&&cancelAnimationFrame(r),clearTimeout(i),t?.disconnect(),document.removeEventListener("astro:page-load",s),document.removeEventListener("astro:after-swap",s)}}function xe(e){const t=u.useSyncExternalStore(ie,()=>z,()=>N);return u.useMemo(()=>t.length>0?t:e&&e.length>0?O(se(e)):t,[t,e])}function S(e,t){for(const n of e){if(n.id===t)return n;const r=S(n.children,t);if(r)return r}return null}function _(e){const t=[];let n=e.parent;for(;n;)t.push(n.id),n=n.parent;return t}function D(e,t){const n=[];return e.parent?e.parent.children.forEach(r=>{r.id!==e.id&&r.children.length>0&&n.push(r.id)}):t.forEach(r=>{r.id!==e.id&&r.children.length>0&&n.push(r.id)}),n}function ae(e){let t="";const n=new Set;let r=null;const o=new Map,a=()=>{n.forEach(i=>i())},l=()=>{if(o.size===0)return;let i="",c=Number.POSITIVE_INFINITY;o.forEach((f,h)=>{f<c&&(c=f,i=h)}),t!==i&&(t=i,a())},d=()=>{r&&r.disconnect(),o.clear();const i=`-${e}px 0px -70% 0px`;r=new IntersectionObserver(f=>{for(const h of f){const m=h.target.id;m&&(h.isIntersecting?o.set(m,h.boundingClientRect.top):o.delete(m))}l()},{rootMargin:i,threshold:0});const c=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");c.forEach(f=>{r?.observe(f)}),c.length>0&&o.size===0&&requestAnimationFrame(()=>{const f=Array.from(c);for(let h=f.length-1;h>=0;h--){const m=f[h];if(m.getBoundingClientRect().top<e&&m.id){t!==m.id&&(t=m.id,a());break}}})},s=()=>{t="",o.clear(),requestAnimationFrame(()=>{d()})};return{subscribe:i=>(n.size===0&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{d()})}),document.addEventListener("astro:page-load",s)),n.add(i),()=>{n.delete(i),n.size===0&&(r&&(r.disconnect(),r=null),document.removeEventListener("astro:page-load",s),o.clear())}),getSnapshot:()=>t,getServerSnapshot:()=>""}}function ye({offsetTop:e=120}={}){const t=u.useMemo(()=>ae(e),[e]);return u.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot)}function Ee({headings:e,activeId:t,defaultExpanded:n=!1}){const[r,o]=u.useState(()=>{if(n){let s=function(c){c.forEach(f=>{f.children.length>0&&i.add(f.id),s(f.children)})};const i=new Set;return s(e),i}return new Set}),a=u.useMemo(()=>{const s=new Set(r);if(!t||e.length===0)return s;const i=S(e,t);if(!i)return s;const f=[..._(i)];if(i.children.length>0&&f.unshift(t),f.length===0)return s;const h={};return f.forEach(m=>{const v=S(e,m);v&&(h[v.level]||(h[v.level]=[]),h[v.level].push(m))}),Object.keys(h).forEach(m=>{const v=parseInt(m);h[v].forEach(b=>{const w=S(e,b);w&&(D(w,e).forEach(A=>s.delete(A)),s.add(b))})}),s},[t,e,r]),l=u.useCallback(s=>a.has(s),[a]),d=u.useCallback(s=>{o(i=>{const c=new Set(i);return c.has(s)?c.delete(s):c.add(s),c})},[]);return{expandedIds:a,isExpanded:l,toggleExpanded:d,setExpandedIds:o}}function Ce({headings:e,setExpandedIds:t}){return u.useCallback(n=>{const r=document.getElementById(n);if(!r)return;r.scrollIntoView({behavior:"smooth",block:"start"}),window.location.hash!==`#${n}`&&history.pushState(null,"",`#${n}`);const o=S(e,n);if(!o)return;const a=_(o);o.children.length>0&&a.unshift(n),a.length!==0&&t(l=>{const d=new Set(l),s={};return a.forEach(i=>{const c=S(e,i);c&&(s[c.level]||(s[c.level]=[]),s[c.level].push(i))}),Object.keys(s).forEach(i=>{const c=parseInt(i,10);s[c].forEach(h=>{const m=S(e,h);m&&(D(m,e).forEach(I=>d.delete(I)),d.add(h))})}),d})},[e,t])}const ce=.75,le=1,ue=({heading:e,depth:t=0,isActive:n=!1,isExpanded:r=!1,onHeadingClick:o,renderChildren:a})=>{const l=e.children.length>0;return p.jsxs("div",{className:"heading-tree-item relative",children:[p.jsxs("a",{href:`#${e.id}`,onClick:d=>{d.preventDefault(),o(e.id)},className:j("heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2",{"bg-primary/10 text-primary border-l-primary hover:text-primary hover:bg-primary/10 font-medium":n}),style:{paddingLeft:`${ce+t*le}rem`,paddingRight:l?"0.5rem":"0.75rem"},"data-level":e.level,"aria-label":e.text,"aria-current":n?"location":void 0,children:[p.jsx("span",{className:"heading-text block flex-1 truncate leading-relaxed",children:e.text}),n&&p.jsx("span",{className:"text-primary ml-2 text-xs",children:"•"})]}),l&&r&&a&&p.jsx("div",{className:"heading-children",children:a(e.children,t+1)})]},e.id)},T=u.memo(ue),de=({headings:e,depth:t=0,activeId:n,expandedIds:r,onHeadingClick:o})=>{const a=(l,d)=>l.map(s=>p.jsx(T,{heading:s,depth:d,isActive:n===s.id,isExpanded:r.has(s.id),onHeadingClick:o,renderChildren:a},s.id));return p.jsx(p.Fragment,{children:e.map(l=>p.jsx(T,{heading:l,depth:t,isActive:n===l.id,isExpanded:r.has(l.id),onHeadingClick:o,renderChildren:a},l.id))})},Se=u.memo(de),we={alternate:"snow"},Ae={github:{url:"https://github.com/XueHua-s",label:"GitHub",iconText:"GH",iconClass:"fa-brands fa-github",color:"#191717"},x:{url:"https://x.com/xiaoxueljx?s=21",label:"X (推特)",iconText:"X",iconClass:"fa-brands fa-x-twitter",color:"#4b9ae4"},email:{url:"mailto:xuehualjx@gmail.com",label:"Email",iconText:"@",iconClass:"fa-regular fa-envelope",color:"#55acd5"}};Array.from({length:13},(e,t)=>t+1).map(e=>`/img/cover/${e}.webp`);const y="/blog";var C=(e=>(e[e.Home=y]="Home",e.About=`${y}/about`,e.Categories=`${y}/categories`,e.Tags=`${y}/tags`,e.Friends=`${y}/friends`,e.Weekly=`${y}/weekly`,e.Post=`${y}/post`,e.Posts=`${y}/posts`,e.Archives=`${y}/archives`,e))(C||{});const Ie=[{name:"首页",path:C.Home,icon:"fa-solid fa-house-chimney"},{name:"文章",icon:"fa-solid fa-pen-nib",children:[{name:"分类",path:C.Categories,icon:"fa-solid fa-layer-group"},{name:"标签",path:C.Tags,icon:"fa-solid fa-tags"},{name:"周刊",path:C.Weekly,icon:"fa-regular fa-newspaper"}]},{name:"友链",path:C.Friends,icon:"fa-solid fa-link"},{name:"关于",path:C.About,icon:"fa-regular fa-circle-user"}],F=Z("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm ring-offset-background transition-colors focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline","gradient-shoka":"bg-gradient-shoka-button text-primary-foreground",unstyle:""},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});function Le({url:e,label:t,variant:n,size:r,className:o,children:a,...l}){if(typeof e=="string"&&e.length>0){const s=l;return p.jsx("a",{href:e,"aria-label":t,className:j(F({variant:n,size:r}),o),...s,children:a})}return p.jsx("button",{type:"button",className:j(F({variant:n,size:r}),o),...l,children:a})}export{ve as A,Le as B,Se as H,C as R,ye as a,Ee as b,Ce as c,be as d,Ae as e,we as f,Ie as r,xe as u};

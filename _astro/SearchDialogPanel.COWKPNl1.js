import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{u as D}from"./index.D8A-VS5Y.js";import{a as S}from"./index.DWT_5Rag.js";import{h as f,i as A,s as j}from"./ui.C_U_C0Uo.js";import{r as s}from"./index.vDeobAm6.js";import"./index.B1BUzvhR.js";import"./_Uint8Array.CF0sjrPO.js";import"./toNumber.COiLbGnR.js";import"./_baseIsEqual.DPm_D5DJ.js";import"./index.BSdFiPHn.js";import"./_commonjsHelpers.CqkleIqs.js";function p(){const t=Array.from(document.querySelectorAll(".pagefind-ui__result")),a=document.querySelector(".pagefind-ui__button");return a&&a.offsetParent!==null?[...t,a]:t}function T(){const[t,a]=s.useState(-1),l=s.useCallback(()=>{const o=p();t>=0&&t<o.length&&o[t]?.removeAttribute("data-selected")},[t]),d=s.useCallback(()=>{l(),a(-1)},[l]),u=s.useCallback(o=>{const n=p();if(n.length===0){a(-1);return}const i=Math.max(-1,Math.min(o,n.length-1));if(t>=0&&t<n.length&&n[t]?.removeAttribute("data-selected"),a(i),i>=0){n[i]?.setAttribute("data-selected","true"),n[i]?.scrollIntoView({block:"nearest",behavior:"smooth"});return}document.querySelector(".pagefind-ui__search-input")?.focus()},[t]),c=s.useCallback(()=>{const o=p();if(t<0||t>=o.length)return;const n=o[t];if(n.classList.contains("pagefind-ui__button")){n.click(),a(-1);return}const i=n.querySelector(".pagefind-ui__result-link");i?.href&&(f(),window.location.href=i.href)},[t]);return{selectedIndex:t,setSelectedIndex:a,clearSelection:d,clearSelectionDom:l,selectResult:u,navigateToSelected:c}}function M({state:t,overlayClassName:a,dialogClassName:l,contentClassName:d,onDialogBackgroundClick:u,onDialogClose:c}){return e.jsxs(e.Fragment,{children:[e.jsx("button",{id:"search-overlay",type:"button","data-state":t,className:a,"aria-label":"关闭搜索",onClick:u}),e.jsx("div",{id:"search-dialog","data-state":t,className:l,role:"dialog","aria-label":"搜索文章","aria-modal":"true",children:e.jsx("div",{id:"search-dialog-content",className:d,children:e.jsxs("div",{className:"relative p-6 md:p-3",children:[e.jsxs("div",{className:"search-dialog",children:[e.jsxs("div",{className:"relative mb-4 flex items-center justify-between",children:[e.jsxs("h2",{className:"flex items-center gap-2 text-lg font-semibold md:text-base",children:[e.jsx("i",{className:"fa-solid fa-magnifying-glass text-base md:text-sm","aria-hidden":"true"}),"搜索文章"]}),e.jsx("button",{id:"search-dialog-close",className:"flex size-8 items-center justify-center rounded-full bg-black/5 transition-colors duration-300 hover:bg-black/10 md:size-7 dark:bg-white/10 dark:hover:bg-white/20","aria-label":"关闭搜索",onClick:c,children:e.jsx("i",{className:"fa-solid fa-xmark text-base md:text-sm","aria-hidden":"true"})})]}),e.jsxs("div",{id:"search-empty-hint",className:"search-empty-hint absolute inset-x-0 top-32 text-center text-sm opacity-60 md:top-28",children:[e.jsx("p",{children:"输入关键词搜索博客文章"}),e.jsxs("p",{className:"mt-1 text-xs",children:["按"," ",e.jsx("kbd",{className:"rounded bg-black/10 px-1.5 py-0.5 font-mono dark:bg-white/10",children:"ESC"})," ","关闭"]})]}),e.jsx("div",{className:"vertical-scrollbar scroll-feather-mask -mx-6 h-[calc(80dvh-140px)] overflow-auto scroll-smooth px-6 pb-10 md:-mx-3 md:h-[calc(80dvh-120px)] md:px-3",children:e.jsx("div",{id:"search-dialog-container"})})]}),e.jsxs("div",{className:"bg-background/2 absolute inset-x-0 bottom-0 z-10 flex items-center justify-center gap-4 px-4 pt-2 pb-4 text-xs text-black/50 dark:border-white/10 dark:text-white/50",children:[e.jsxs("span",{children:[e.jsx("kbd",{className:"kbd",children:"↑↓"})," 选择"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"kbd",children:"Enter"})," 打开"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"kbd",children:"ESC"})," 关闭"]})]})]})})})]})}const R=200,q=150;function G(){const t=D(j),[a,l]=s.useState("closed"),[d,u]=s.useState(!1),c=s.useRef(null),o=s.useRef(null),n=s.useRef(null),i=s.useCallback(()=>document,[]),{selectedIndex:m,setSelectedIndex:b,clearSelection:x,clearSelectionDom:g,selectResult:h,navigateToSelected:k}=T(),w=s.useCallback(()=>{n.current?.disconnect();const r=document.getElementById("search-dialog-container");if(!r)return;const v=new MutationObserver(()=>{x()});v.observe(r,{childList:!0,subtree:!0}),n.current=v},[x]),C=s.useCallback(r=>{if((r.metaKey||r.ctrlKey)&&r.key.toLowerCase()==="k"){r.preventDefault(),A();return}if(j.get()){if(r.key==="Escape")return f();if(r.key==="ArrowDown")return r.preventDefault(),h(m+1);if(r.key==="ArrowUp")return r.preventDefault(),h(m-1);r.key==="Enter"&&m>=0&&(r.preventDefault(),k())}},[k,h,m]),y=s.useCallback(()=>{f()},[]),N=s.useCallback(r=>{r.target===r.currentTarget&&f()},[]);s.useEffect(()=>{if(c.current&&(window.clearTimeout(c.current),c.current=null),o.current&&(window.clearTimeout(o.current),o.current=null),t){document.body.style.overflow="hidden",window.dispatchEvent(new CustomEvent("search-dialog-open")),requestAnimationFrame(()=>{l("open"),u(!0)}),o.current=window.setTimeout(()=>{document.querySelector(".pagefind-ui__search-input")?.focus()},q),w();return}g(),n.current?.disconnect(),n.current=null,window.dispatchEvent(new CustomEvent("search-dialog-close")),requestAnimationFrame(()=>{u(!1)}),queueMicrotask(()=>{b(-1)}),c.current=window.setTimeout(()=>{l("closed"),document.body.style.overflow=""},R)},[g,t,b,w]),S("keydown",C,i),S("astro:before-preparation",y,i),s.useEffect(()=>()=>{c.current&&window.clearTimeout(c.current),o.current&&window.clearTimeout(o.current),n.current?.disconnect(),document.body.style.overflow=""},[]);const E=s.useMemo(()=>`fixed inset-0 z-40 bg-black/50 backdrop-blur-sm transition-opacity duration-200 ${d?"opacity-100":"opacity-0"} ${a==="closed"?"hidden":""}`,[d,a]),_=s.useMemo(()=>`fixed inset-0 z-50 grid place-items-center px-4 ${a==="closed"?"hidden":""}`,[a]),I=s.useMemo(()=>`bg-gradient-start shadow-box w-full max-w-3xl overflow-auto rounded-xl transition-all duration-200 ${d?"opacity-100":"opacity-0"}`,[d]);return e.jsx(M,{state:a,overlayClassName:E,dialogClassName:_,contentClassName:I,onDialogBackgroundClick:N,onDialogClose:y})}export{G as default};

import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{u as T}from"./index.D8A-VS5Y.js";import{a as S}from"./index.DWT_5Rag.js";import{a as h,o as D,s as C}from"./ui.B4yy_69F.js";import{r as s}from"./index.vDeobAm6.js";import"./index.B1BUzvhR.js";import"./_Uint8Array.CF0sjrPO.js";import"./toNumber.COiLbGnR.js";import"./_baseIsEqual.DPm_D5DJ.js";import"./index.BSdFiPHn.js";import"./_commonjsHelpers.CqkleIqs.js";const M=200,R=150;function b(){const l=Array.from(document.querySelectorAll(".pagefind-ui__result")),n=document.querySelector(".pagefind-ui__button");return n&&n.offsetParent!==null?[...l,n]:l}function G(){const l=T(C),[n,x]=s.useState("closed"),[m,g]=s.useState(!1),[r,d]=s.useState(-1),c=s.useRef(null),i=s.useRef(null),u=s.useRef(null),k=s.useCallback(()=>document,[]),f=s.useCallback(()=>{const e=b();r>=0&&r<e.length&&e[r]?.removeAttribute("data-selected")},[r]),w=s.useCallback(()=>{f(),d(-1)},[f]),p=s.useCallback(e=>{const a=b();if(a.length===0){d(-1);return}const o=Math.max(-1,Math.min(e,a.length-1));if(r>=0&&r<a.length&&a[r]?.removeAttribute("data-selected"),d(o),o>=0){a[o]?.setAttribute("data-selected","true"),a[o]?.scrollIntoView({block:"nearest",behavior:"smooth"});return}document.querySelector(".pagefind-ui__search-input")?.focus()},[r]),y=s.useCallback(()=>{const e=b();if(r<0||r>=e.length)return;const a=e[r];if(a.classList.contains("pagefind-ui__button")){a.click(),d(-1);return}const o=a.querySelector(".pagefind-ui__result-link");o?.href&&(h(),window.location.href=o.href)},[r]),v=s.useCallback(()=>{u.current?.disconnect();const e=document.getElementById("search-dialog-container");if(!e)return;const a=new MutationObserver(()=>{w()});a.observe(e,{childList:!0,subtree:!0}),u.current=a},[w]),N=s.useCallback(e=>{if((e.metaKey||e.ctrlKey)&&e.key.toLowerCase()==="k"){e.preventDefault(),D();return}if(C.get()){if(e.key==="Escape"){h();return}if(e.key==="ArrowDown"){e.preventDefault(),p(r+1);return}if(e.key==="ArrowUp"){e.preventDefault(),p(r-1);return}e.key==="Enter"&&r>=0&&(e.preventDefault(),y())}},[y,p,r]),j=s.useCallback(()=>{h()},[]),E=s.useCallback(e=>{e.target===e.currentTarget&&h()},[]);s.useEffect(()=>{if(c.current&&(window.clearTimeout(c.current),c.current=null),i.current&&(window.clearTimeout(i.current),i.current=null),l){document.body.style.overflow="hidden",window.dispatchEvent(new CustomEvent("search-dialog-open")),requestAnimationFrame(()=>{x("open"),g(!0)}),i.current=window.setTimeout(()=>{document.querySelector(".pagefind-ui__search-input")?.focus()},R),v();return}f(),u.current?.disconnect(),u.current=null,window.dispatchEvent(new CustomEvent("search-dialog-close")),requestAnimationFrame(()=>{g(!1)}),queueMicrotask(()=>{d(-1)}),c.current=window.setTimeout(()=>{x("closed"),document.body.style.overflow=""},M)},[f,l,v]),S("keydown",N,k),S("astro:before-preparation",j,k),s.useEffect(()=>()=>{c.current&&window.clearTimeout(c.current),i.current&&window.clearTimeout(i.current),u.current?.disconnect(),document.body.style.overflow=""},[]);const _=s.useMemo(()=>`fixed inset-0 z-40 bg-black/50 backdrop-blur-sm transition-opacity duration-200 ${m?"opacity-100":"opacity-0"} ${n==="closed"?"hidden":""}`,[m,n]),A=s.useMemo(()=>`fixed inset-0 z-50 grid place-items-center px-4 ${n==="closed"?"hidden":""}`,[n]),I=s.useMemo(()=>`bg-gradient-start shadow-box w-full max-w-3xl overflow-auto rounded-xl transition-all duration-200 ${m?"opacity-100":"opacity-0"}`,[m]);return t.jsxs(t.Fragment,{children:[t.jsx("button",{id:"search-overlay",type:"button","data-state":n,className:_,"aria-label":"关闭搜索",onClick:E}),t.jsx("div",{id:"search-dialog","data-state":n,className:A,role:"dialog","aria-label":"搜索文章","aria-modal":"true",children:t.jsx("div",{id:"search-dialog-content",className:I,children:t.jsxs("div",{className:"relative p-6 md:p-3",children:[t.jsxs("div",{className:"search-dialog",children:[t.jsxs("div",{className:"relative mb-4 flex items-center justify-between",children:[t.jsxs("h2",{className:"flex items-center gap-2 text-lg font-semibold md:text-base",children:[t.jsx("i",{className:"fa-solid fa-magnifying-glass text-base md:text-sm","aria-hidden":"true"}),"搜索文章"]}),t.jsx("button",{id:"search-dialog-close",className:"flex size-8 items-center justify-center rounded-full bg-black/5 transition-colors duration-300 hover:bg-black/10 md:size-7 dark:bg-white/10 dark:hover:bg-white/20","aria-label":"关闭搜索",onClick:j,children:t.jsx("i",{className:"fa-solid fa-xmark text-base md:text-sm","aria-hidden":"true"})})]}),t.jsxs("div",{id:"search-empty-hint",className:"search-empty-hint absolute inset-x-0 top-32 text-center text-sm opacity-60 md:top-28",children:[t.jsx("p",{children:"输入关键词搜索博客文章"}),t.jsxs("p",{className:"mt-1 text-xs",children:["按"," ",t.jsx("kbd",{className:"rounded bg-black/10 px-1.5 py-0.5 font-mono dark:bg-white/10",children:"ESC"})," ","关闭"]})]}),t.jsx("div",{className:"vertical-scrollbar scroll-feather-mask -mx-6 h-[calc(80dvh-140px)] overflow-auto scroll-smooth px-6 pb-10 md:-mx-3 md:h-[calc(80dvh-120px)] md:px-3",children:t.jsx("div",{id:"search-dialog-container"})})]}),t.jsxs("div",{className:"bg-background/2 absolute inset-x-0 bottom-0 z-10 flex items-center justify-center gap-4 px-4 pt-2 pb-4 text-xs text-black/50 dark:border-white/10 dark:text-white/50",children:[t.jsxs("span",{children:[t.jsx("kbd",{className:"kbd",children:"↑↓"})," 选择"]}),t.jsxs("span",{children:[t.jsx("kbd",{className:"kbd",children:"Enter"})," 打开"]}),t.jsxs("span",{children:[t.jsx("kbd",{className:"kbd",children:"ESC"})," 关闭"]})]})]})})})]})}export{G as default};

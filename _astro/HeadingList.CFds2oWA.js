import{r as p}from"./index.vDeobAm6.js";import{j as v}from"./jsx-runtime.D_zvdyIk.js";import{c as L}from"./utils.BEHD0UYf.js";function S(e){const t=[],n=[];return e.forEach(r=>{const s={...r,children:[]};for(;n.length>0&&n[n.length-1].level>=s.level;)n.pop();if(n.length===0)t.push(s);else{const i=n[n.length-1];i.children.push(s),s.parent=i}n.push(s)}),t}function H(e){return e?e.map(t=>"depth"in t?{id:t.slug,text:t.text,level:t.depth}:t):[]}function q(){if(typeof document>"u")return[];const e=document.querySelector(".custom-content")??document.querySelector("article");if(!e)return[];const t=Array.from(e.querySelectorAll("h1, h2, h3, h4, h5, h6")).filter(r=>!r.closest(".link-preview-block"));if(t.length===0)return[];const n=t.map((r,s)=>{let i=r.id;return i||(i=(r.textContent||"").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim()||`heading-${s}`,r.id=i),{id:i,text:r.textContent||"",level:parseInt(r.tagName.substring(1))}});return S(n)}function C(e){if(typeof document>"u")return()=>{};let t=null,n=null;const r=()=>{t&&t.disconnect();const o=document.querySelector(".custom-content")??document.querySelector("article");o?(t=new MutationObserver(()=>{e()}),t.observe(o,{childList:!0,subtree:!0}),e()):n=requestAnimationFrame(()=>{r()})},s=document.querySelector(".custom-content")??document.querySelector("article"),i=s?s.querySelector("h1, h2, h3, h4, h5, h6"):null;s&&i?r():requestAnimationFrame(()=>{requestAnimationFrame(()=>{r()})});const a=()=>{n&&cancelAnimationFrame(n),requestAnimationFrame(()=>{requestAnimationFrame(()=>{r()})})};document.addEventListener("astro:page-load",a),document.addEventListener("astro:after-swap",a);const m=setTimeout(()=>{e()},100);return()=>{n&&cancelAnimationFrame(n),clearTimeout(m),t?.disconnect(),document.removeEventListener("astro:page-load",a),document.removeEventListener("astro:after-swap",a)}}function P(e){const t=p.useSyncExternalStore(C,q,()=>[]);return p.useMemo(()=>e&&e.length>0?S(H(e)):t,[t,e])}function g(e,t){for(const n of e){if(n.id===t)return n;const r=g(n.children,t);if(r)return r}return null}function y(e){const t=[];let n=e.parent;for(;n;)t.push(n.id),n=n.parent;return t}function I(e,t){const n=[];return e.parent?e.parent.children.forEach(r=>{r.id!==e.id&&r.children.length>0&&n.push(r.id)}):t.forEach(r=>{r.id!==e.id&&r.children.length>0&&n.push(r.id)}),n}function F(e){let t="";const n=new Set;let r=null;const s=new Map,i=()=>{n.forEach(c=>c())},a=()=>{if(s.size===0)return;let c="",u=Number.POSITIVE_INFINITY;s.forEach((l,d)=>{l<u&&(u=l,c=d)}),t!==c&&(t=c,i())},m=()=>{r&&r.disconnect(),s.clear();const c=`-${e}px 0px -70% 0px`;r=new IntersectionObserver(l=>{for(const d of l){const f=d.target.id;f&&(d.isIntersecting?s.set(f,d.boundingClientRect.top):s.delete(f))}a()},{rootMargin:c,threshold:0});const u=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");u.forEach(l=>{r?.observe(l)}),u.length>0&&s.size===0&&requestAnimationFrame(()=>{const l=Array.from(u);for(let d=l.length-1;d>=0;d--){const f=l[d];if(f.getBoundingClientRect().top<e&&f.id){t!==f.id&&(t=f.id,i());break}}})},o=()=>{t="",s.clear(),requestAnimationFrame(()=>{m()})};return{subscribe:c=>(n.size===0&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{m()})}),document.addEventListener("astro:page-load",o)),n.add(c),()=>{n.delete(c),n.size===0&&(r&&(r.disconnect(),r=null),document.removeEventListener("astro:page-load",o),s.clear())}),getSnapshot:()=>t,getServerSnapshot:()=>""}}function $({offsetTop:e=120}={}){const t=p.useMemo(()=>F(e),[e]);return p.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot)}function z({headings:e,activeId:t,defaultExpanded:n=!1}){const[r,s]=p.useState(()=>{if(n){let o=function(u){u.forEach(l=>{l.children.length>0&&c.add(l.id),o(l.children)})};const c=new Set;return o(e),c}return new Set}),i=p.useMemo(()=>{const o=new Set(r);if(!t||e.length===0)return o;const c=g(e,t);if(!c)return o;const l=[...y(c)];if(c.children.length>0&&l.unshift(t),l.length===0)return o;const d={};return l.forEach(f=>{const h=g(e,f);h&&(d[h.level]||(d[h.level]=[]),d[h.level].push(f))}),Object.keys(d).forEach(f=>{const h=parseInt(f);d[h].forEach(b=>{const x=g(e,b);x&&(I(x,e).forEach(w=>o.delete(w)),o.add(b))})}),o},[t,e,r]),a=p.useCallback(o=>i.has(o),[i]),m=p.useCallback(o=>{s(c=>{const u=new Set(c);return u.has(o)?u.delete(o):u.add(o),u})},[]);return{expandedIds:i,isExpanded:a,toggleExpanded:m,setExpandedIds:s}}function _({headings:e,setExpandedIds:t}){return p.useCallback(n=>{const r=document.getElementById(n);if(!r)return;r.scrollIntoView({behavior:"smooth",block:"start"});const s=encodeURIComponent(n);window.location.hash!==`#${s}`&&history.pushState(null,"",`#${s}`);const i=g(e,n);if(!i)return;const a=y(i);i.children.length>0&&a.unshift(n),a.length!==0&&t(m=>{const o=new Set(m),c={};return a.forEach(u=>{const l=g(e,u);l&&(c[l.level]||(c[l.level]=[]),c[l.level].push(u))}),Object.keys(c).forEach(u=>{const l=parseInt(u,10);c[l].forEach(f=>{const h=g(e,f);h&&(I(h,e).forEach(b=>o.delete(b)),o.add(f))})}),o})},[e,t])}const N=.75,j=1,k=({heading:e,depth:t=0,isActive:n=!1,isExpanded:r=!1,onHeadingClick:s,renderChildren:i})=>{const a=e.children.length>0;return v.jsxs("div",{className:"heading-tree-item relative",children:[v.jsxs("a",{href:`#${encodeURIComponent(e.id)}`,onClick:m=>{m.preventDefault(),s(e.id)},className:L("heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2",{"bg-primary/10 text-primary border-l-primary hover:text-primary hover:bg-primary/10 font-medium":n}),style:{paddingLeft:`${N+t*j}rem`,paddingRight:a?"0.5rem":"0.75rem"},"data-level":e.level,"aria-label":e.text,"aria-current":n?"location":void 0,children:[v.jsx("span",{className:"heading-text block flex-1 truncate leading-relaxed",children:e.text}),n&&v.jsx("span",{className:"text-primary ml-2 text-xs",children:"â€¢"})]}),a&&r&&i&&v.jsx("div",{className:"heading-children",children:i(e.children,t+1)})]},e.id)},E=p.memo(k),T=({headings:e,depth:t=0,activeId:n,expandedIds:r,onHeadingClick:s})=>{const i=(a,m)=>a.map(o=>v.jsx(E,{heading:o,depth:m,isActive:n===o.id,isExpanded:r.has(o.id),onHeadingClick:s,renderChildren:i},o.id));return v.jsx(v.Fragment,{children:e.map(a=>v.jsx(E,{heading:a,depth:t,isActive:n===a.id,isExpanded:r.has(a.id),onHeadingClick:s,renderChildren:i},a.id))})},D=p.memo(T);export{D as H,$ as a,z as b,_ as c,P as u};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/mermaid.core.qLugkBY0.js","_astro/preload-helper.BlTxHScW.js","_astro/_commonjsHelpers.CqkleIqs.js","_astro/_Uint8Array.CF0sjrPO.js"])))=>i.map(i=>d[i]);
import{r as I}from"./index.vDeobAm6.js";import{c as W,e as _}from"./code-block-enhancer.B27gCbhN.js";import{_ as F}from"./preload-helper.BlTxHScW.js";import"./_commonjsHelpers.CqkleIqs.js";const x=new WeakSet,Y=1,D=5;function N(){return{scale:1,translateX:0,translateY:0,lastPinchDistance:0,isPinching:!1,isPanning:!1,isMouseDragging:!1,lastPanPoint:{x:0,y:0}}}let r=N(),i=null;function z(){let e=document.querySelector(".markdown-image-lightbox");return e?i=e.querySelector(".markdown-image-lightbox-img"):(e=U(),document.body.appendChild(e)),e}function O(){const e=document.createElement("button");return e.className="markdown-image-fullscreen",e.setAttribute("type","button"),e.setAttribute("aria-label","全屏查看"),e.title="全屏查看",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>',e}function B(e){if(e.length<2)return 0;const n=e[0].clientX-e[1].clientX,t=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+t*t)}function $(e){return e.length<2?{x:e[0].clientX,y:e[0].clientY}:{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}}function R(e){if(r.scale<=1)return;const n=e.getBoundingClientRect(),t=window.innerWidth,a=window.innerHeight,o=n.width,s=n.height,l=Math.max(0,(o-t)/2+t*.3),c=Math.max(0,(s-a)/2+a*.3);r.translateX=Math.max(-l,Math.min(l,r.translateX)),r.translateY=Math.max(-c,Math.min(c,r.translateY))}function f(e){R(e);const{scale:n,translateX:t,translateY:a}=r;e.style.transform=`translate(${t}px, ${a}px) scale(${n})`,e.style.cursor=n>1?r.isMouseDragging?"grabbing":"grab":"zoom-in"}function g(){r=N(),i&&(i.style.transform="",i.style.cursor="zoom-in")}function j(e){e.touches.length===2?(e.preventDefault(),r.isPinching=!0,r.lastPinchDistance=B(e.touches)):e.touches.length===1&&r.scale>1&&(r.isPanning=!0,r.lastPanPoint={x:e.touches[0].clientX,y:e.touches[0].clientY})}function G(e){if(i){if(e.touches.length===2&&r.isPinching){e.preventDefault();const n=B(e.touches),t=n/r.lastPinchDistance;let a=r.scale*t;if(a=Math.max(Y,Math.min(D,a)),a!==r.scale){const o=$(e.touches),s=i.getBoundingClientRect(),l=s.left+s.width/2,c=s.top+s.height/2,m=a/r.scale;r.translateX=o.x-(o.x-l-r.translateX)*m-l,r.translateY=o.y-(o.y-c-r.translateY)*m-c,r.scale=a,f(i)}r.lastPinchDistance=n}else if(e.touches.length===1&&r.isPanning&&r.scale>1){e.preventDefault();const n=e.touches[0].clientX-r.lastPanPoint.x,t=e.touches[0].clientY-r.lastPanPoint.y;r.translateX+=n,r.translateY+=t,r.lastPanPoint={x:e.touches[0].clientX,y:e.touches[0].clientY},f(i)}}}function E(e){e.touches.length<2&&(r.isPinching=!1),e.touches.length===0&&(r.isPanning=!1,i&&r.scale>1&&(i.style.cursor="grab")),r.scale<1.05&&g()}function K(e){if(!e.ctrlKey&&!e.metaKey||!i)return;e.preventDefault();const n=e.deltaY>0?.9:1.1;let t=r.scale*n;if(t=Math.max(Y,Math.min(D,t)),t!==r.scale){const a=i.getBoundingClientRect(),o=a.left+a.width/2,s=a.top+a.height/2,l=t/r.scale;r.translateX=e.clientX-(e.clientX-o-r.translateX)*l-o,r.translateY=e.clientY-(e.clientY-s-r.translateY)*l-s,r.scale=t,f(i)}r.scale<1.05&&g()}function V(e){if(!(!i||!e.target.classList.contains("markdown-image-lightbox-img")))if(e.preventDefault(),e.stopPropagation(),r.scale>1)g();else{const t=i.getBoundingClientRect(),a=t.left+t.width/2,o=t.top+t.height/2,s=2,l=s/r.scale;r.translateX=e.clientX-(e.clientX-a)*l-a,r.translateY=e.clientY-(e.clientY-o)*l-o,r.scale=s,f(i)}}function Z(e){if(!r.isMouseDragging||r.scale<=1||!i)return;const n=e.clientX-r.lastPanPoint.x,t=e.clientY-r.lastPanPoint.y;r.translateX+=n,r.translateY+=t,r.lastPanPoint={x:e.clientX,y:e.clientY},f(i)}function L(){r.isMouseDragging&&(r.isMouseDragging=!1,i&&r.scale>1&&(i.style.cursor="grab"))}function U(){const e=document.createElement("div");e.className="markdown-image-lightbox",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-label","图片全屏查看");const n=document.createElement("button");n.className="markdown-image-lightbox-close",n.setAttribute("type","button"),n.setAttribute("aria-label","关闭"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';const t=document.createElement("div");t.className="markdown-image-lightbox-content";const a=document.createElement("img");return a.className="markdown-image-lightbox-img",i=a,t.appendChild(a),e.appendChild(n),e.appendChild(t),e.addEventListener("click",o=>{r.scale>1||(o.target===e||o.target===t)&&b()}),n.addEventListener("click",b),t.addEventListener("touchstart",j,{passive:!1}),t.addEventListener("touchmove",G,{passive:!1}),t.addEventListener("touchend",E),t.addEventListener("touchcancel",E),t.addEventListener("wheel",K,{passive:!1}),a.addEventListener("dblclick",V),a.addEventListener("mousedown",o=>{r.scale>1&&(o.preventDefault(),r.isMouseDragging=!0,r.lastPanPoint={x:o.clientX,y:o.clientY},a.style.cursor="grabbing")}),t.addEventListener("mousemove",Z),t.addEventListener("mouseup",L),t.addEventListener("mouseleave",L),e}function C(e,n){const t=z();g(),i&&(i.classList.remove("loaded"),i.src="",i.alt=n,i.src=e,i.onload=()=>{i?.classList.add("loaded")},t.classList.add("active"),document.body.classList.add("lightbox-open"),document.addEventListener("keydown",q))}function b(){const e=document.querySelector(".markdown-image-lightbox");e&&(e.classList.remove("active"),document.body.classList.remove("lightbox-open"),document.removeEventListener("keydown",q),g())}function q(e){e.key==="Escape"&&b()}function J(e){const n=document.createElement("div");n.className="markdown-image-error",n.setAttribute("role","img"),n.setAttribute("aria-label",e.alt?`图片加载失败: ${e.alt}`:"图片加载失败");const t=document.createElement("span");t.className="markdown-image-error-icon",t.setAttribute("aria-hidden","true");const a=document.createElement("span");return a.className="markdown-image-error-text",a.textContent="图片加载失败",n.appendChild(t),n.appendChild(a),n}function Q(e){const n=e.target;if(n.classList.contains("markdown-image")){const t=n;C(t.src,t.alt||"图片")}else if(n.closest(".markdown-image-fullscreen")){const a=n.closest(".markdown-image-wrapper")?.querySelector(".markdown-image");a&&(e.stopPropagation(),C(a.src,a.alt||"图片"))}}function ee(e){const n=e.querySelectorAll(".markdown-image");let t=0;const a=n.length;e.addEventListener("click",Q);const o=()=>{t++,t>=a&&P(e)};n.forEach(s=>{if(x.has(s)){o();return}if(x.add(s),s.complete&&s.naturalWidth>0){A(s),o();return}if(s.complete&&s.naturalWidth===0){M(s),o();return}s.addEventListener("load",()=>{A(s),o()},{once:!0}),s.addEventListener("error",()=>{M(s),o()},{once:!0})}),a===0&&P(e)}function A(e){e.classList.add("loaded"),e.naturalHeight>e.naturalWidth*1.2&&e.closest(".markdown-image-wrapper")?.classList.add("portrait");const t=e.closest(".markdown-image-wrapper");if(!t||t.querySelector(".markdown-image-fullscreen"))return;const a=O();t.appendChild(a),e.style.cursor="zoom-in"}function M(e){e.classList.add("error");const n=e.closest(".markdown-image-wrapper");if(n&&!n.querySelector(".markdown-image-error")){const t=J(e);n.appendChild(t)}}function P(e){const n=Array.from(e.querySelectorAll(".markdown-image-wrapper"));let t=[];const a=()=>{if(t.length>=2){const o=document.createElement("div");o.className="markdown-image-row",t[0].parentNode?.insertBefore(o,t[0]);const s=document.createDocumentFragment();t.forEach(l=>{s.appendChild(l)}),o.appendChild(s)}t=[]};n.forEach((o,s)=>{const l=o.classList.contains("portrait");if(!o.parentElement?.classList.contains("markdown-image-row"))if(l){const c=n[s-1];t.length>0&&c&&c.classList.contains("portrait")&&te(c,o)?t.push(o):(a(),t=[o])}else a()}),a()}function te(e,n){let t=e.nextSibling;for(;t;){if(t.nodeType===Node.TEXT_NODE&&t.textContent?.trim()===""){t=t.nextSibling;continue}return t===n}return!1}let d=[],u=[],h=null,p=null,S=!1,T=null;function ne(){return`
    <div class="mermaid-toolbar">
      <div class="mermaid-dots">
        <span class="mermaid-dot red"></span>
        <span class="mermaid-dot yellow"></span>
        <span class="mermaid-dot green"></span>
        <span class="mermaid-language">mermaid</span>
      </div>
      <div class="mermaid-actions">
        <button
          class="mermaid-button mermaid-fullscreen"
          aria-label="Fullscreen"
          title="Fullscreen"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
          </svg>
        </button>
        <button
          class="mermaid-button mermaid-copy"
          aria-label="Copy source"
          title="Copy source"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 448 512" fill="currentColor">
            <path d="M192 0c-35.3 0-64 28.7-64 64l0 256c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-200.6c0-17.4-7.1-34.1-19.7-46.2L370.6 17.8C358.7 6.4 342.8 0 326.3 0L192 0zM64 128c-35.3 0-64 28.7-64 64L0 448c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-16-64 0 0 16-192 0 0-256 16 0 0-64-16 0z"/>
          </svg>
        </button>
      </div>
    </div>
  `}function ae(){const e=`checkmark-mermaid-${Date.now()}`;return`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
      <mask id="${e}">
        <g fill="none" stroke="#fff" stroke-dasharray="24" stroke-dashoffset="24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
          <path d="M2 13.5l4 4l10.75 -10.75">
            <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.4s" values="24;0"/>
          </path>
          <path stroke="#000" stroke-width="6" d="M7.5 13.5l4 4l10.75 -10.75">
            <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.4s" values="24;0"/>
          </path>
          <path d="M7.5 13.5l4 4l10.75 -10.75">
            <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.4s" values="24;0"/>
          </path>
        </g>
      </mask>
      <rect width="24" height="24" fill="currentColor" mask="url(#${e})"/>
    </svg>`}function w(e){return e.parentElement?.classList.contains("mermaid-wrapper")??!1}function v(e){if(e.dataset.toolbarEnhanced==="true"||w(e))return;const n=document.createElement("div");n.className="mermaid-wrapper",e.parentNode?.insertBefore(n,e),n.appendChild(e),e.insertAdjacentHTML("beforebegin",ne()),e.dataset.toolbarEnhanced="true";const t=e.getAttribute("data-diagram")||e.textContent||"",a=n.querySelector(".mermaid-copy");if(a){const s=a.innerHTML,l=async()=>{await W(t)&&(a.classList.add("copied"),a.innerHTML=ae(),setTimeout(()=>{a.classList.remove("copied"),a.innerHTML=s},2e3))};a.addEventListener("click",()=>{l()})}const o=n.querySelector(".mermaid-fullscreen");o&&o.addEventListener("click",()=>{const s=e.innerHTML;window.dispatchEvent(new CustomEvent("open-mermaid-fullscreen",{detail:{svg:s,source:t}}))})}function H(){for(const e of d)e.disconnect();d=[];for(const e of u)clearTimeout(e);u=[],h&&(window.removeEventListener("mermaid:rendered",h),h=null)}function re(){return(document.documentElement.getAttribute("data-theme")??document.body?.getAttribute("data-theme"))==="dark"?"dark":"default"}async function y(){const e=document.querySelectorAll("pre.mermaid:not([data-processed])");if(e.length!==0){if(!p){const{default:n}=await F(async()=>{const{default:t}=await import("./mermaid.core.qLugkBY0.js").then(a=>a.be);return{default:t}},__vite__mapDeps([0,1,2,3]));p=n}p.initialize({startOnLoad:!1,theme:re(),gitGraph:{mainBranchName:"main",showCommitLabel:!0,showBranches:!0,rotateCommitLabel:!0}});for(const n of e){n.hasAttribute("data-diagram")||n.setAttribute("data-diagram",n.textContent||"");const t=n.getAttribute("data-diagram")||"",a=`mermaid-${Math.random().toString(36).slice(2,11)}`;try{const{svg:o}=await p.render(a,t);n.innerHTML=o}catch(o){console.error("[mermaid-nav-fix] Error:",o)}finally{n.setAttribute("data-processed","true")}}window.dispatchEvent(new CustomEvent("mermaid:rendered"))}}function oe(){S||(document.addEventListener("astro:after-swap",()=>{requestAnimationFrame(()=>{y()})}),T=new MutationObserver(()=>{document.querySelectorAll("pre.mermaid[data-processed]").forEach(e=>e.removeAttribute("data-processed")),y()}),T.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),S=!0)}function X(){document.querySelectorAll("pre.mermaid").forEach(n=>{const t=n;if(!(t.dataset.toolbarEnhanced==="true"||w(t)))if(t.getAttribute("data-processed")==="true")v(t);else{const a=new MutationObserver((s,l)=>{for(const c of s)if(c.type==="attributes"&&c.attributeName==="data-processed"&&t.getAttribute("data-processed")==="true"){v(t),l.disconnect();const m=d.indexOf(l);m>-1&&d.splice(m,1);return}});a.observe(t,{attributes:!0,attributeFilter:["data-processed"]}),d.push(a);const o=setTimeout(()=>{a.disconnect();const s=d.indexOf(a);s>-1&&d.splice(s,1);const l=u.indexOf(o);l>-1&&u.splice(l,1),t.dataset.toolbarEnhanced!=="true"&&!w(t)&&v(t)},5e3);u.push(o)}})}function se(){oe(),H(),y();const e=setTimeout(X,100);u.push(e),h=()=>{setTimeout(X,50)},window.addEventListener("mermaid:rendered",h)}typeof document<"u"&&document.addEventListener("astro:before-swap",H);const k="data-enhanced";function ie(e){const n=document.querySelector(".custom-content");n&&n.getAttribute(k)!=="true"&&(e.addBlankTarget&&n.querySelectorAll("a[href]").forEach(a=>{const o=a,s=o.getAttribute("href")||"";(s.startsWith("http")||s.startsWith("//"))&&o.setAttribute("target","_blank")}),e.smoothScroll&&n.querySelectorAll('a.anchor-link[href^="#"]').forEach(a=>{const o=a;o.addEventListener("click",s=>{s.preventDefault();const l=o.getAttribute("href")?.substring(1);if(!l)return;const c=document.getElementById(l);c&&(c.scrollIntoView({behavior:"smooth",block:"start"}),history.pushState(null,"",`#${l}`))})}),e.addHeadingLevel&&n.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(a=>{const o=a.tagName[1];a.setAttribute("data-level",`H${o}`)}),e.enhanceCodeBlock&&(_(n,{enableCopy:e.enableCodeCopy,enableFullscreen:e.enableCodeFullscreen,onFullscreen:t=>{window.dispatchEvent(new CustomEvent("open-code-fullscreen",{detail:{code:t.code,codeHTML:t.codeHTML,language:t.language,preClassName:t.preClassName,preStyle:t.preStyle,codeClassName:t.codeClassName}}))}}),se()),ee(n),n.setAttribute(k,"true"))}function me({config:e}){return I.useEffect(()=>{const n=()=>{const t=document.querySelector(".custom-content");t&&t.removeAttribute(k),ie(e)};return n(),document.addEventListener("astro:page-load",n),()=>{document.removeEventListener("astro:page-load",n)}},[e]),null}export{me as CustomContentEnhancer};

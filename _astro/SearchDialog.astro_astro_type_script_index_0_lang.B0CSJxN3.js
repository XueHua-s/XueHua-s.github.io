import{a as i,s as o,o as d}from"./ui.CKI2j8mQ.js";import"./index.BSdFiPHn.js";const u={overlay:"search-overlay",dialog:"search-dialog",content:"search-dialog-content",closeBtn:"search-dialog-close"},n={opacityFull:"opacity-100",opacityZero:"opacity-0"},l={open:"open",closed:"closed"};class h{elements;unsubscribe=null;selectedIndex=-1;resultsObserver=null;constructor(){this.elements=this.initElements(),this.validateElements()&&(this.bindEvents(),this.subscribeToStore())}initElements(){return Object.entries(u).reduce((e,[t,s])=>({...e,[t]:document.getElementById(s)}),{})}validateElements(){return Object.entries(this.elements).every(([e,t])=>{const s=!!t;return s||console.error(`搜索对话框元素未找到: ${e}`),s})}bindEvents(){document.addEventListener("keydown",this.handleKeyDown),this.elements.closeBtn?.addEventListener("click",this.handleClose),this.elements.dialog?.addEventListener("click",this.handleBackgroundClick)}handleBackgroundClick=e=>{e.target===this.elements.dialog&&i()};subscribeToStore(){this.unsubscribe=o.subscribe(e=>{e?this.open():this.close()})}handleKeyDown=e=>{if((e.metaKey||e.ctrlKey)&&e.key==="k"){e.preventDefault(),d();return}if(o.get()){if(e.key==="Escape"){i();return}if(e.key==="ArrowDown"){e.preventDefault(),this.selectResult(this.selectedIndex+1);return}if(e.key==="ArrowUp"){e.preventDefault(),this.selectResult(this.selectedIndex-1);return}e.key==="Enter"&&this.selectedIndex>=0&&(e.preventDefault(),this.navigateToSelected())}};handleClose=()=>{i()};getSelectableItems(){const e=Array.from(document.querySelectorAll(".pagefind-ui__result")),t=document.querySelector(".pagefind-ui__button");return t&&t.offsetParent!==null?[...e,t]:e}selectResult(e){const t=this.getSelectableItems();if(t.length===0){this.selectedIndex=-1;return}const s=Math.max(-1,Math.min(e,t.length-1));this.selectedIndex>=0&&this.selectedIndex<t.length&&t[this.selectedIndex]?.removeAttribute("data-selected"),this.selectedIndex=s,s>=0?(t[s].setAttribute("data-selected","true"),t[s].scrollIntoView({block:"nearest",behavior:"smooth"})):document.querySelector(".pagefind-ui__search-input")?.focus()}navigateToSelected(){const e=this.getSelectableItems();if(this.selectedIndex<0||this.selectedIndex>=e.length)return;const t=e[this.selectedIndex];if(t.classList.contains("pagefind-ui__button")){t.click(),this.selectedIndex=-1;return}const s=t.querySelector(".pagefind-ui__result-link");s?.href&&(i(),window.location.href=s.href)}clearSelection(){const e=this.getSelectableItems();this.selectedIndex>=0&&this.selectedIndex<e.length&&e[this.selectedIndex]?.removeAttribute("data-selected"),this.selectedIndex=-1}setupResultsObserver(){const e=document.getElementById("search-dialog-container");e&&(this.resultsObserver=new MutationObserver(()=>{this.clearSelection()}),this.resultsObserver.observe(e,{childList:!0,subtree:!0}))}open(){const{overlay:e,dialog:t,content:s}=this.elements;!e||!t||!s||(e.dataset.state=l.open,t.dataset.state=l.open,document.body.style.overflow="hidden",window.dispatchEvent(new CustomEvent("search-dialog-open")),requestAnimationFrame(()=>{e.classList.remove(n.opacityZero),e.classList.add(n.opacityFull),s.classList.remove(n.opacityZero),s.classList.add(n.opacityFull)}),setTimeout(()=>{const r=document.querySelector(".pagefind-ui__search-input");r&&r.focus()},150),this.setupResultsObserver())}close(){const{overlay:e,dialog:t,content:s}=this.elements;!e||!t||!s||(this.clearSelection(),this.resultsObserver?.disconnect(),this.resultsObserver=null,window.dispatchEvent(new CustomEvent("search-dialog-close")),e.classList.remove(n.opacityFull),e.classList.add(n.opacityZero),s.classList.remove(n.opacityFull),s.classList.add(n.opacityZero),setTimeout(()=>{e.dataset.state=l.closed,t.dataset.state=l.closed,document.body.style.overflow=""},200))}destroy(){document.removeEventListener("keydown",this.handleKeyDown),this.elements.closeBtn?.removeEventListener("click",this.handleClose),this.elements.dialog?.removeEventListener("click",this.handleBackgroundClick),this.resultsObserver?.disconnect(),this.resultsObserver=null,this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}}let c=null;function a(){c?.destroy(),c=new h}document.readyState!=="loading"&&a();document.addEventListener("astro:page-load",a);document.addEventListener("astro:before-preparation",()=>{i()});

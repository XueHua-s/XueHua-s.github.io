import{r as h}from"./index.vDeobAm6.js";import{j as p}from"./jsx-runtime.D_zvdyIk.js";import{c as L}from"./utils.BEHD0UYf.js";function w(e){const r=[],t=[];return e.forEach(n=>{const s={...n,children:[]};for(;t.length>0&&t[t.length-1].level>=s.level;)t.pop();if(t.length===0)r.push(s);else{const i=t[t.length-1];i.children.push(s),s.parent=i}t.push(s)}),r}function H(){if(typeof document>"u")return[];const e=document.querySelector(".custom-content")??document.querySelector("article");if(!e)return[];const r=Array.from(e.querySelectorAll("h1, h2, h3, h4, h5, h6")).filter(n=>!n.closest(".link-preview-block"));if(r.length===0)return[];const t=r.map((n,s)=>{let i=n.id;return i||(i=(n.textContent||"").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim()||`heading-${s}`,n.id=i),{id:i,text:n.textContent||"",level:parseInt(n.tagName.substring(1))}});return w(t)}function q(e){if(typeof document>"u")return()=>{};let r=null,t=null;const n=()=>{r&&r.disconnect();const o=document.querySelector(".custom-content")??document.querySelector("article");o?(r=new MutationObserver(()=>{e()}),r.observe(o,{childList:!0,subtree:!0}),e()):t=requestAnimationFrame(()=>{n()})},s=document.querySelector(".custom-content")??document.querySelector("article"),i=s?s.querySelector("h1, h2, h3, h4, h5, h6"):null;s&&i?n():requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})});const a=()=>{t&&cancelAnimationFrame(t),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})})};document.addEventListener("astro:page-load",a),document.addEventListener("astro:after-swap",a);const m=setTimeout(()=>{e()},100);return()=>{t&&cancelAnimationFrame(t),clearTimeout(m),r?.disconnect(),document.removeEventListener("astro:page-load",a),document.removeEventListener("astro:after-swap",a)}}function M(){return h.useSyncExternalStore(q,H,()=>[])}function v(e,r){for(const t of e){if(t.id===r)return t;const n=v(t.children,r);if(n)return n}return null}function y(e){const r=[];let t=e.parent;for(;t;)r.push(t.id),t=t.parent;return r}function I(e,r){const t=[];return e.parent?e.parent.children.forEach(n=>{n.id!==e.id&&n.children.length>0&&t.push(n.id)}):r.forEach(n=>{n.id!==e.id&&n.children.length>0&&t.push(n.id)}),t}function C(e){let r="";const t=new Set;let n=null;const s=new Map,i=()=>{t.forEach(c=>c())},a=()=>{if(s.size===0)return;let c="",l=Number.POSITIVE_INFINITY;s.forEach((d,u)=>{d<l&&(l=d,c=u)}),r!==c&&(r=c,i())},m=()=>{n&&n.disconnect(),s.clear();const c=`-${e}px 0px -70% 0px`;n=new IntersectionObserver(d=>{for(const u of d){const f=u.target.id;f&&(u.isIntersecting?s.set(f,u.boundingClientRect.top):s.delete(f))}a()},{rootMargin:c,threshold:0});const l=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");l.forEach(d=>{n?.observe(d)}),l.length>0&&s.size===0&&requestAnimationFrame(()=>{const d=Array.from(l);for(let u=d.length-1;u>=0;u--){const f=d[u];if(f.getBoundingClientRect().top<e&&f.id){r!==f.id&&(r=f.id,i());break}}})},o=()=>{r="",s.clear(),requestAnimationFrame(()=>{m()})};return{subscribe:c=>(t.size===0&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{m()})}),document.addEventListener("astro:page-load",o)),t.add(c),()=>{t.delete(c),t.size===0&&(n&&(n.disconnect(),n=null),document.removeEventListener("astro:page-load",o),s.clear())}),getSnapshot:()=>r,getServerSnapshot:()=>""}}function R({offsetTop:e=120}={}){const r=h.useMemo(()=>C(e),[e]);return h.useSyncExternalStore(r.subscribe,r.getSnapshot,r.getServerSnapshot)}function z({headings:e,activeId:r,defaultExpanded:t=!1}){const[n,s]=h.useState(()=>{if(t){let o=function(l){l.forEach(d=>{d.children.length>0&&c.add(d.id),o(d.children)})};const c=new Set;return o(e),c}return new Set}),i=h.useMemo(()=>{const o=new Set(n);if(!r||e.length===0)return o;const c=v(e,r);if(!c)return o;const d=[...y(c)];if(c.children.length>0&&d.unshift(r),d.length===0)return o;const u={};return d.forEach(f=>{const g=v(e,f);g&&(u[g.level]||(u[g.level]=[]),u[g.level].push(f))}),Object.keys(u).forEach(f=>{const g=parseInt(f);u[g].forEach(x=>{const E=v(e,x);E&&(I(E,e).forEach(A=>o.delete(A)),o.add(x))})}),o},[r,e,n]),a=h.useCallback(o=>i.has(o),[i]),m=h.useCallback(o=>{s(c=>{const l=new Set(c);return l.has(o)?l.delete(o):l.add(o),l})},[]);return{expandedIds:i,isExpanded:a,toggleExpanded:m,setExpandedIds:s}}function _({headings:e,setExpandedIds:r}){return h.useCallback(t=>{const n=document.getElementById(t);if(!n)return;n.scrollIntoView({behavior:"smooth",block:"start"});const s=v(e,t);if(!s)return;const i=y(s);s.children.length>0&&i.unshift(t),i.length!==0&&r(a=>{const m=new Set(a),o={};return i.forEach(c=>{const l=v(e,c);l&&(o[l.level]||(o[l.level]=[]),o[l.level].push(c))}),Object.keys(o).forEach(c=>{const l=parseInt(c,10);o[l].forEach(u=>{const f=v(e,u);f&&(I(f,e).forEach(b=>m.delete(b)),m.add(u))})}),m})},[e,r])}const F=.75,N=1,j=({heading:e,depth:r=0,isActive:t=!1,isExpanded:n=!1,onHeadingClick:s,renderChildren:i})=>{const a=e.children.length>0;return p.jsxs("div",{className:"heading-tree-item relative",children:[p.jsxs("a",{href:`#${e.id}`,onClick:m=>{m.preventDefault(),s(e.id)},className:L("heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2",{"bg-primary/10 text-primary border-l-primary hover:text-primary hover:bg-primary/10 font-medium":t}),style:{paddingLeft:`${F+r*N}rem`,paddingRight:a?"0.5rem":"0.75rem"},"data-level":e.level,"aria-label":e.text,"aria-current":t?"location":void 0,children:[p.jsx("span",{className:"heading-text block flex-1 truncate leading-relaxed",children:e.text}),t&&p.jsx("span",{className:"text-primary ml-2 text-xs",children:"â€¢"})]}),a&&n&&i&&p.jsx("div",{className:"heading-children",children:i(e.children,r+1)})]},e.id)},S=h.memo(j),k=({headings:e,depth:r=0,activeId:t,expandedIds:n,onHeadingClick:s})=>{const i=(a,m)=>a.map(o=>p.jsx(S,{heading:o,depth:m,isActive:t===o.id,isExpanded:n.has(o.id),onHeadingClick:s,renderChildren:i},o.id));return p.jsx(p.Fragment,{children:e.map(a=>p.jsx(S,{heading:a,depth:r,isActive:t===a.id,isExpanded:n.has(a.id),onHeadingClick:s,renderChildren:i},a.id))})},$=h.memo(k);export{$ as H,R as a,z as b,_ as c,M as u};

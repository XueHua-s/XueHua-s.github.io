import{r as N}from"./index.vDeobAm6.js";import{c as B,e as H}from"./code-block-enhancer.B27gCbhN.js";import"./_commonjsHelpers.CqkleIqs.js";const y=new WeakSet,P=1,S=5;function X(){return{scale:1,translateX:0,translateY:0,lastPinchDistance:0,isPinching:!1,isPanning:!1,isMouseDragging:!1,lastPanPoint:{x:0,y:0}}}let a=X(),i=null;function q(){let e=document.querySelector(".markdown-image-lightbox");return e?i=e.querySelector(".markdown-image-lightbox-img"):(e=j(),document.body.appendChild(e)),e}function I(){const e=document.createElement("button");return e.className="markdown-image-fullscreen",e.setAttribute("type","button"),e.setAttribute("aria-label","全屏查看"),e.title="全屏查看",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>',e}function Y(e){if(e.length<2)return 0;const n=e[0].clientX-e[1].clientX,t=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+t*t)}function W(e){return e.length<2?{x:e[0].clientX,y:e[0].clientY}:{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}}function z(e){if(a.scale<=1)return;const n=e.getBoundingClientRect(),t=window.innerWidth,r=window.innerHeight,s=n.width,o=n.height,l=Math.max(0,(s-t)/2+t*.3),c=Math.max(0,(o-r)/2+r*.3);a.translateX=Math.max(-l,Math.min(l,a.translateX)),a.translateY=Math.max(-c,Math.min(c,a.translateY))}function f(e){z(e);const{scale:n,translateX:t,translateY:r}=a;e.style.transform=`translate(${t}px, ${r}px) scale(${n})`,e.style.cursor=n>1?a.isMouseDragging?"grabbing":"grab":"zoom-in"}function g(){a=X(),i&&(i.style.transform="",i.style.cursor="zoom-in")}function $(e){e.touches.length===2?(e.preventDefault(),a.isPinching=!0,a.lastPinchDistance=Y(e.touches)):e.touches.length===1&&a.scale>1&&(a.isPanning=!0,a.lastPanPoint={x:e.touches[0].clientX,y:e.touches[0].clientY})}function F(e){if(i){if(e.touches.length===2&&a.isPinching){e.preventDefault();const n=Y(e.touches),t=n/a.lastPinchDistance;let r=a.scale*t;if(r=Math.max(P,Math.min(S,r)),r!==a.scale){const s=W(e.touches),o=i.getBoundingClientRect(),l=o.left+o.width/2,c=o.top+o.height/2,m=r/a.scale;a.translateX=s.x-(s.x-l-a.translateX)*m-l,a.translateY=s.y-(s.y-c-a.translateY)*m-c,a.scale=r,f(i)}a.lastPinchDistance=n}else if(e.touches.length===1&&a.isPanning&&a.scale>1){e.preventDefault();const n=e.touches[0].clientX-a.lastPanPoint.x,t=e.touches[0].clientY-a.lastPanPoint.y;a.translateX+=n,a.translateY+=t,a.lastPanPoint={x:e.touches[0].clientX,y:e.touches[0].clientY},f(i)}}}function k(e){e.touches.length<2&&(a.isPinching=!1),e.touches.length===0&&(a.isPanning=!1,i&&a.scale>1&&(i.style.cursor="grab")),a.scale<1.05&&g()}function R(e){if(!e.ctrlKey&&!e.metaKey||!i)return;e.preventDefault();const n=e.deltaY>0?.9:1.1;let t=a.scale*n;if(t=Math.max(P,Math.min(S,t)),t!==a.scale){const r=i.getBoundingClientRect(),s=r.left+r.width/2,o=r.top+r.height/2,l=t/a.scale;a.translateX=e.clientX-(e.clientX-s-a.translateX)*l-s,a.translateY=e.clientY-(e.clientY-o-a.translateY)*l-o,a.scale=t,f(i)}a.scale<1.05&&g()}function O(e){if(!(!i||!e.target.classList.contains("markdown-image-lightbox-img")))if(e.preventDefault(),e.stopPropagation(),a.scale>1)g();else{const t=i.getBoundingClientRect(),r=t.left+t.width/2,s=t.top+t.height/2,o=2,l=o/a.scale;a.translateX=e.clientX-(e.clientX-r)*l-r,a.translateY=e.clientY-(e.clientY-s)*l-s,a.scale=o,f(i)}}function _(e){if(!a.isMouseDragging||a.scale<=1||!i)return;const n=e.clientX-a.lastPanPoint.x,t=e.clientY-a.lastPanPoint.y;a.translateX+=n,a.translateY+=t,a.lastPanPoint={x:e.clientX,y:e.clientY},f(i)}function x(){a.isMouseDragging&&(a.isMouseDragging=!1,i&&a.scale>1&&(i.style.cursor="grab"))}function j(){const e=document.createElement("div");e.className="markdown-image-lightbox",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-label","图片全屏查看");const n=document.createElement("button");n.className="markdown-image-lightbox-close",n.setAttribute("type","button"),n.setAttribute("aria-label","关闭"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';const t=document.createElement("div");t.className="markdown-image-lightbox-content";const r=document.createElement("img");return r.className="markdown-image-lightbox-img",i=r,t.appendChild(r),e.appendChild(n),e.appendChild(t),e.addEventListener("click",s=>{a.scale>1||(s.target===e||s.target===t)&&v()}),n.addEventListener("click",v),t.addEventListener("touchstart",$,{passive:!1}),t.addEventListener("touchmove",F,{passive:!1}),t.addEventListener("touchend",k),t.addEventListener("touchcancel",k),t.addEventListener("wheel",R,{passive:!1}),r.addEventListener("dblclick",O),r.addEventListener("mousedown",s=>{a.scale>1&&(s.preventDefault(),a.isMouseDragging=!0,a.lastPanPoint={x:s.clientX,y:s.clientY},r.style.cursor="grabbing")}),t.addEventListener("mousemove",_),t.addEventListener("mouseup",x),t.addEventListener("mouseleave",x),e}function L(e,n){const t=q();g(),i&&(i.classList.remove("loaded"),i.src="",i.alt=n,i.src=e,i.onload=()=>{i?.classList.add("loaded")},t.classList.add("active"),document.body.classList.add("lightbox-open"),document.addEventListener("keydown",T))}function v(){const e=document.querySelector(".markdown-image-lightbox");e&&(e.classList.remove("active"),document.body.classList.remove("lightbox-open"),document.removeEventListener("keydown",T),g())}function T(e){e.key==="Escape"&&v()}function K(e){const n=document.createElement("div");n.className="markdown-image-error",n.setAttribute("role","img"),n.setAttribute("aria-label",e.alt?`图片加载失败: ${e.alt}`:"图片加载失败");const t=document.createElement("span");t.className="markdown-image-error-icon",t.setAttribute("aria-hidden","true");const r=document.createElement("span");return r.className="markdown-image-error-text",r.textContent="图片加载失败",n.appendChild(t),n.appendChild(r),n}function Z(e){const n=e.target;if(n.classList.contains("markdown-image")){const t=n;L(t.src,t.alt||"图片")}else if(n.closest(".markdown-image-fullscreen")){const r=n.closest(".markdown-image-wrapper")?.querySelector(".markdown-image");r&&(e.stopPropagation(),L(r.src,r.alt||"图片"))}}function G(e){const n=e.querySelectorAll(".markdown-image");let t=0;const r=n.length;e.addEventListener("click",Z);const s=()=>{t++,t>=r&&M(e)};n.forEach(o=>{if(y.has(o)){s();return}if(y.add(o),o.complete&&o.naturalWidth>0){E(o),s();return}if(o.complete&&o.naturalWidth===0){C(o),s();return}o.addEventListener("load",()=>{E(o),s()},{once:!0}),o.addEventListener("error",()=>{C(o),s()},{once:!0})}),r===0&&M(e)}function E(e){e.classList.add("loaded"),e.naturalHeight>e.naturalWidth*1.2&&e.closest(".markdown-image-wrapper")?.classList.add("portrait");const t=e.closest(".markdown-image-wrapper");if(!t||t.querySelector(".markdown-image-fullscreen"))return;const r=I();t.appendChild(r),e.style.cursor="zoom-in"}function C(e){e.classList.add("error");const n=e.closest(".markdown-image-wrapper");if(n&&!n.querySelector(".markdown-image-error")){const t=K(e);n.appendChild(t)}}function M(e){const n=Array.from(e.querySelectorAll(".markdown-image-wrapper"));let t=[];const r=()=>{if(t.length>=2){const s=document.createElement("div");s.className="markdown-image-row",t[0].parentNode?.insertBefore(s,t[0]);const o=document.createDocumentFragment();t.forEach(l=>{o.appendChild(l)}),s.appendChild(o)}t=[]};n.forEach((s,o)=>{const l=s.classList.contains("portrait");if(!s.parentElement?.classList.contains("markdown-image-row"))if(l){const c=n[o-1];t.length>0&&c&&c.classList.contains("portrait")&&V(c,s)?t.push(s):(r(),t=[s])}else r()}),r()}function V(e,n){let t=e.nextSibling;for(;t;){if(t.nodeType===Node.TEXT_NODE&&t.textContent?.trim()===""){t=t.nextSibling;continue}return t===n}return!1}let d=[],u=[],h=null;function U(){return`
    <div class="mermaid-toolbar">
      <div class="mermaid-dots">
        <span class="mermaid-dot red"></span>
        <span class="mermaid-dot yellow"></span>
        <span class="mermaid-dot green"></span>
        <span class="mermaid-language">mermaid</span>
      </div>
      <div class="mermaid-actions">
        <button
          class="mermaid-button mermaid-fullscreen"
          aria-label="Fullscreen"
          title="Fullscreen"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
          </svg>
        </button>
        <button
          class="mermaid-button mermaid-copy"
          aria-label="Copy source"
          title="Copy source"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 448 512" fill="currentColor">
            <path d="M192 0c-35.3 0-64 28.7-64 64l0 256c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-200.6c0-17.4-7.1-34.1-19.7-46.2L370.6 17.8C358.7 6.4 342.8 0 326.3 0L192 0zM64 128c-35.3 0-64 28.7-64 64L0 448c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-16-64 0 0 16-192 0 0-256 16 0 0-64-16 0z"/>
          </svg>
        </button>
      </div>
    </div>
  `}function J(){const e=`checkmark-mermaid-${Date.now()}`;return`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
      <mask id="${e}">
        <g fill="none" stroke="#fff" stroke-dasharray="24" stroke-dashoffset="24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
          <path d="M2 13.5l4 4l10.75 -10.75">
            <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.4s" values="24;0"/>
          </path>
          <path stroke="#000" stroke-width="6" d="M7.5 13.5l4 4l10.75 -10.75">
            <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.4s" values="24;0"/>
          </path>
          <path d="M7.5 13.5l4 4l10.75 -10.75">
            <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.4s" values="24;0"/>
          </path>
        </g>
      </mask>
      <rect width="24" height="24" fill="currentColor" mask="url(#${e})"/>
    </svg>`}function w(e){return e.parentElement?.classList.contains("mermaid-wrapper")??!1}function p(e){if(e.dataset.toolbarEnhanced==="true"||w(e))return;const n=document.createElement("div");n.className="mermaid-wrapper",e.parentNode?.insertBefore(n,e),n.appendChild(e),e.insertAdjacentHTML("beforebegin",U()),e.dataset.toolbarEnhanced="true";const t=e.getAttribute("data-diagram")||e.textContent||"",r=n.querySelector(".mermaid-copy");if(r){const o=r.innerHTML,l=async()=>{await B(t)&&(r.classList.add("copied"),r.innerHTML=J(),setTimeout(()=>{r.classList.remove("copied"),r.innerHTML=o},2e3))};r.addEventListener("click",()=>{l()})}const s=n.querySelector(".mermaid-fullscreen");s&&s.addEventListener("click",()=>{const o=e.innerHTML;window.dispatchEvent(new CustomEvent("open-mermaid-fullscreen",{detail:{svg:o,source:t}}))})}function D(){for(const e of d)e.disconnect();d=[];for(const e of u)clearTimeout(e);u=[],h&&(window.removeEventListener("mermaid:rendered",h),h=null)}function A(){document.querySelectorAll("pre.mermaid").forEach(n=>{const t=n;if(!(t.dataset.toolbarEnhanced==="true"||w(t)))if(t.getAttribute("data-processed")==="true")p(t);else{const r=new MutationObserver((o,l)=>{for(const c of o)if(c.type==="attributes"&&c.attributeName==="data-processed"&&t.getAttribute("data-processed")==="true"){p(t),l.disconnect();const m=d.indexOf(l);m>-1&&d.splice(m,1);return}});r.observe(t,{attributes:!0,attributeFilter:["data-processed"]}),d.push(r);const s=setTimeout(()=>{r.disconnect();const o=d.indexOf(r);o>-1&&d.splice(o,1);const l=u.indexOf(s);l>-1&&u.splice(l,1),t.dataset.toolbarEnhanced!=="true"&&!w(t)&&p(t)},5e3);u.push(s)}})}function Q(){D();const e=setTimeout(A,100);u.push(e),h=()=>{setTimeout(A,50)},window.addEventListener("mermaid:rendered",h)}typeof document<"u"&&document.addEventListener("astro:before-swap",D);const b="data-enhanced";function ee(e){const n=document.querySelector(".custom-content");n&&n.getAttribute(b)!=="true"&&(e.addBlankTarget&&n.querySelectorAll("a[href]").forEach(r=>{const s=r,o=s.getAttribute("href")||"";(o.startsWith("http")||o.startsWith("//"))&&s.setAttribute("target","_blank")}),e.smoothScroll&&n.querySelectorAll('a.anchor-link[href^="#"]').forEach(r=>{const s=r;s.addEventListener("click",o=>{o.preventDefault();const l=s.getAttribute("href")?.substring(1);if(!l)return;const c=document.getElementById(l);c&&(c.scrollIntoView({behavior:"smooth",block:"start"}),history.pushState(null,"",`#${l}`))})}),e.addHeadingLevel&&n.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(r=>{const s=r.tagName[1];r.setAttribute("data-level",`H${s}`)}),e.enhanceCodeBlock&&(H(n,{enableCopy:e.enableCodeCopy,enableFullscreen:e.enableCodeFullscreen,onFullscreen:t=>{window.dispatchEvent(new CustomEvent("open-code-fullscreen",{detail:{code:t.code,codeHTML:t.codeHTML,language:t.language,preClassName:t.preClassName,preStyle:t.preStyle,codeClassName:t.codeClassName}}))}}),Q()),G(n),n.setAttribute(b,"true"))}function re({config:e}){return N.useEffect(()=>{const n=()=>{const t=document.querySelector(".custom-content");t&&t.removeAttribute(b),ee(e)};return n(),document.addEventListener("astro:page-load",n),()=>{document.removeEventListener("astro:page-load",n)}},[e]),null}export{re as CustomContentEnhancer};

import{r as p}from"./index.vDeobAm6.js";import{k,l as F,p as T}from"./proxy.k8ZnVpfL.js";import{j as h}from"./jsx-runtime.D_zvdyIk.js";import{c as N}from"./utils.BEHD0UYf.js";function Y(){!k.current&&F();const[e]=p.useState(T.current);return e}const A=[];let H=A,S="";const w=e=>e.map(t=>`${t.id}:${t.level}:${t.text}:${w(t.children)}`).join("|"),y=()=>{const e=R(),t=w(e);return t===S?!1:(S=t,H=e,!0)};function L(e){const t=[],n=[];return e.forEach(r=>{const s={...r,children:[]};for(;n.length>0&&n[n.length-1].level>=s.level;)n.pop();if(n.length===0)t.push(s);else{const i=n[n.length-1];i.children.push(s),s.parent=i}n.push(s)}),t}function M(e){return e?e.map(t=>"depth"in t?{id:t.slug,text:t.text,level:t.depth}:t):[]}function R(){if(typeof document>"u")return[];const e=document.querySelector(".custom-content")??document.querySelector("article");if(!e)return[];const t=Array.from(e.querySelectorAll("h1, h2, h3, h4, h5, h6")).filter(r=>!r.closest(".link-preview-block"));if(t.length===0)return[];const n=t.map((r,s)=>{let i=r.id;return i||(i=(r.textContent||"").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim()||`heading-${s}`,r.id=i),{id:i,text:r.textContent||"",level:parseInt(r.tagName.substring(1))}});return L(n)}function $(e){if(typeof document>"u")return()=>{};let t=null,n=null,r=null;const s=()=>{r===null&&(r=requestAnimationFrame(()=>{r=null,y()&&e()}))},i=()=>{t&&t.disconnect();const a=document.querySelector(".custom-content")??document.querySelector("article");a?(t=new MutationObserver(()=>{s()}),t.observe(a,{childList:!0,subtree:!0}),y(),s()):n=requestAnimationFrame(()=>{i()})},c=document.querySelector(".custom-content")??document.querySelector("article"),m=c?c.querySelector("h1, h2, h3, h4, h5, h6"):null;c&&m?i():requestAnimationFrame(()=>{requestAnimationFrame(()=>{i()})});const o=()=>{n&&cancelAnimationFrame(n),requestAnimationFrame(()=>{requestAnimationFrame(()=>{i()})})};document.addEventListener("astro:page-load",o),document.addEventListener("astro:after-swap",o);const l=setTimeout(()=>{s()},100);return()=>{n&&cancelAnimationFrame(n),r&&cancelAnimationFrame(r),clearTimeout(l),t?.disconnect(),document.removeEventListener("astro:page-load",o),document.removeEventListener("astro:after-swap",o)}}function U(e){const t=p.useSyncExternalStore($,()=>H,()=>A);return p.useMemo(()=>t.length>0?t:e&&e.length>0?L(M(e)):t,[t,e])}function b(e,t){for(const n of e){if(n.id===t)return n;const r=b(n.children,t);if(r)return r}return null}function q(e){const t=[];let n=e.parent;for(;n;)t.push(n.id),n=n.parent;return t}function C(e,t){const n=[];return e.parent?e.parent.children.forEach(r=>{r.id!==e.id&&r.children.length>0&&n.push(r.id)}):t.forEach(r=>{r.id!==e.id&&r.children.length>0&&n.push(r.id)}),n}function P(e){let t="";const n=new Set;let r=null;const s=new Map,i=()=>{n.forEach(l=>l())},c=()=>{if(s.size===0)return;let l="",a=Number.POSITIVE_INFINITY;s.forEach((u,d)=>{u<a&&(a=u,l=d)}),t!==l&&(t=l,i())},m=()=>{r&&r.disconnect(),s.clear();const l=`-${e}px 0px -70% 0px`;r=new IntersectionObserver(u=>{for(const d of u){const f=d.target.id;f&&(d.isIntersecting?s.set(f,d.boundingClientRect.top):s.delete(f))}c()},{rootMargin:l,threshold:0});const a=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");a.forEach(u=>{r?.observe(u)}),a.length>0&&s.size===0&&requestAnimationFrame(()=>{const u=Array.from(a);for(let d=u.length-1;d>=0;d--){const f=u[d];if(f.getBoundingClientRect().top<e&&f.id){t!==f.id&&(t=f.id,i());break}}})},o=()=>{t="",s.clear(),requestAnimationFrame(()=>{m()})};return{subscribe:l=>(n.size===0&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{m()})}),document.addEventListener("astro:page-load",o)),n.add(l),()=>{n.delete(l),n.size===0&&(r&&(r.disconnect(),r=null),document.removeEventListener("astro:page-load",o),s.clear())}),getSnapshot:()=>t,getServerSnapshot:()=>""}}function J({offsetTop:e=120}={}){const t=p.useMemo(()=>P(e),[e]);return p.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot)}function Q({headings:e,activeId:t,defaultExpanded:n=!1}){const[r,s]=p.useState(()=>{if(n){let o=function(a){a.forEach(u=>{u.children.length>0&&l.add(u.id),o(u.children)})};const l=new Set;return o(e),l}return new Set}),i=p.useMemo(()=>{const o=new Set(r);if(!t||e.length===0)return o;const l=b(e,t);if(!l)return o;const u=[...q(l)];if(l.children.length>0&&u.unshift(t),u.length===0)return o;const d={};return u.forEach(f=>{const g=b(e,f);g&&(d[g.level]||(d[g.level]=[]),d[g.level].push(f))}),Object.keys(d).forEach(f=>{const g=parseInt(f);d[g].forEach(x=>{const E=b(e,x);E&&(C(E,e).forEach(j=>o.delete(j)),o.add(x))})}),o},[t,e,r]),c=p.useCallback(o=>i.has(o),[i]),m=p.useCallback(o=>{s(l=>{const a=new Set(l);return a.has(o)?a.delete(o):a.add(o),a})},[]);return{expandedIds:i,isExpanded:c,toggleExpanded:m,setExpandedIds:s}}function W({headings:e,setExpandedIds:t}){return p.useCallback(n=>{const r=document.getElementById(n);if(!r)return;r.scrollIntoView({behavior:"smooth",block:"start"}),window.location.hash!==`#${n}`&&history.pushState(null,"",`#${n}`);const s=b(e,n);if(!s)return;const i=q(s);s.children.length>0&&i.unshift(n),i.length!==0&&t(c=>{const m=new Set(c),o={};return i.forEach(l=>{const a=b(e,l);a&&(o[a.level]||(o[a.level]=[]),o[a.level].push(l))}),Object.keys(o).forEach(l=>{const a=parseInt(l,10);o[a].forEach(d=>{const f=b(e,d);f&&(C(f,e).forEach(v=>m.delete(v)),m.add(d))})}),m})},[e,t])}const O=.75,B=1,_=({heading:e,depth:t=0,isActive:n=!1,isExpanded:r=!1,onHeadingClick:s,renderChildren:i})=>{const c=e.children.length>0;return h.jsxs("div",{className:"heading-tree-item relative",children:[h.jsxs("a",{href:`#${e.id}`,onClick:m=>{m.preventDefault(),s(e.id)},className:N("heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2",{"bg-primary/10 text-primary border-l-primary hover:text-primary hover:bg-primary/10 font-medium":n}),style:{paddingLeft:`${O+t*B}rem`,paddingRight:c?"0.5rem":"0.75rem"},"data-level":e.level,"aria-label":e.text,"aria-current":n?"location":void 0,children:[h.jsx("span",{className:"heading-text block flex-1 truncate leading-relaxed",children:e.text}),n&&h.jsx("span",{className:"text-primary ml-2 text-xs",children:"•"})]}),c&&r&&i&&h.jsx("div",{className:"heading-children",children:i(e.children,t+1)})]},e.id)},I=p.memo(_),z=({headings:e,depth:t=0,activeId:n,expandedIds:r,onHeadingClick:s})=>{const i=(c,m)=>c.map(o=>h.jsx(I,{heading:o,depth:m,isActive:n===o.id,isExpanded:r.has(o.id),onHeadingClick:s,renderChildren:i},o.id));return h.jsx(h.Fragment,{children:e.map(c=>h.jsx(I,{heading:c,depth:t,isActive:n===c.id,isExpanded:r.has(c.id),onHeadingClick:s,renderChildren:i},c.id))})},Z=p.memo(z),ee={alternate:"snow"},te={github:{url:"https://github.com/XueHua-s",label:"GitHub",iconText:"GH",iconClass:"fa-brands fa-github",color:"#191717"},x:{url:"https://x.com/xiaoxueljx?s=21",label:"X (推特)",iconText:"X",iconClass:"fa-brands fa-x-twitter",color:"#4b9ae4"},email:{url:"mailto:xuehualjx@gmail.com",label:"Email",iconText:"@",iconClass:"fa-regular fa-envelope",color:"#55acd5"}};Array.from({length:13},(e,t)=>t+1).map(e=>`/img/cover/${e}.webp`);export{Z as H,J as a,Q as b,W as c,Y as d,te as e,ee as f,U as u};

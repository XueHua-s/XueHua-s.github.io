import{r as p}from"./index.vDeobAm6.js";import{j as g}from"./jsx-runtime.D_zvdyIk.js";import{c as w}from"./utils.BEHD0UYf.js";function L(t){const r=[],e=[];return t.forEach(n=>{const s={...n,children:[]};for(;e.length>0&&e[e.length-1].level>=s.level;)e.pop();if(e.length===0)r.push(s);else{const i=e[e.length-1];i.children.push(s),s.parent=i}e.push(s)}),r}function H(){if(typeof document>"u")return[];const t=document.querySelector(".custom-content")??document.querySelector("article");if(!t)return[];const r=Array.from(t.querySelectorAll("h1, h2, h3, h4, h5, h6")).filter(n=>!n.closest(".link-preview-block"));if(r.length===0)return[];const e=r.map((n,s)=>{let i=n.id;return i||(i=(n.textContent||"").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim()||`heading-${s}`,n.id=i),{id:i,text:n.textContent||"",level:parseInt(n.tagName.substring(1))}});return L(e)}function q(t){if(typeof document>"u")return()=>{};let r=null,e=null;const n=()=>{r&&r.disconnect();const o=document.querySelector(".custom-content")??document.querySelector("article");o?(r=new MutationObserver(()=>{t()}),r.observe(o,{childList:!0,subtree:!0}),t()):e=requestAnimationFrame(()=>{n()})},s=document.querySelector(".custom-content")??document.querySelector("article"),i=s?s.querySelector("h1, h2, h3, h4, h5, h6"):null;s&&i?n():requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})});const l=()=>{e&&cancelAnimationFrame(e),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})})};document.addEventListener("astro:page-load",l),document.addEventListener("astro:after-swap",l);const m=setTimeout(()=>{t()},100);return()=>{e&&cancelAnimationFrame(e),clearTimeout(m),r?.disconnect(),document.removeEventListener("astro:page-load",l),document.removeEventListener("astro:after-swap",l)}}function P(){return p.useSyncExternalStore(q,H,()=>[])}function v(t,r){for(const e of t){if(e.id===r)return e;const n=v(e.children,r);if(n)return n}return null}function S(t){const r=[];let e=t.parent;for(;e;)r.push(e.id),e=e.parent;return r}function y(t,r){const e=[];return t.parent?t.parent.children.forEach(n=>{n.id!==t.id&&n.children.length>0&&e.push(n.id)}):r.forEach(n=>{n.id!==t.id&&n.children.length>0&&e.push(n.id)}),e}function C(t){let r="";const e=new Set;let n=null;const s=new Map,i=()=>{e.forEach(c=>c())},l=()=>{if(s.size===0)return;let c="",d=Number.POSITIVE_INFINITY;s.forEach((a,u)=>{a<d&&(d=a,c=u)}),r!==c&&(r=c,i())},m=()=>{n&&n.disconnect(),s.clear();const c=`-${t}px 0px -70% 0px`;n=new IntersectionObserver(a=>{for(const u of a){const f=u.target.id;f&&(u.isIntersecting?s.set(f,u.boundingClientRect.top):s.delete(f))}l()},{rootMargin:c,threshold:0});const d=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");d.forEach(a=>{n?.observe(a)}),d.length>0&&s.size===0&&requestAnimationFrame(()=>{const a=Array.from(d);for(let u=a.length-1;u>=0;u--){const f=a[u];if(f.getBoundingClientRect().top<t&&f.id){r!==f.id&&(r=f.id,i());break}}})},o=()=>{r="",s.clear(),requestAnimationFrame(()=>{m()})};return{subscribe:c=>(e.size===0&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{m()})}),document.addEventListener("astro:page-load",o)),e.add(c),()=>{e.delete(c),e.size===0&&(n&&(n.disconnect(),n=null),document.removeEventListener("astro:page-load",o),s.clear())}),getSnapshot:()=>r,getServerSnapshot:()=>""}}function $({offsetTop:t=120}={}){const r=p.useMemo(()=>C(t),[t]);return p.useSyncExternalStore(r.subscribe,r.getSnapshot,r.getServerSnapshot)}function M({headings:t,activeId:r,defaultExpanded:e=!1}){const[n,s]=p.useState(()=>{if(e){let o=function(d){d.forEach(a=>{a.children.length>0&&c.add(a.id),o(a.children)})};const c=new Set;return o(t),c}return new Set}),i=p.useMemo(()=>{const o=new Set(n);if(!r||t.length===0)return o;const c=v(t,r);if(!c)return o;const a=[...S(c)];if(c.children.length>0&&a.unshift(r),a.length===0)return o;const u={};return a.forEach(f=>{const h=v(t,f);h&&(u[h.level]||(u[h.level]=[]),u[h.level].push(f))}),Object.keys(u).forEach(f=>{const h=parseInt(f);u[h].forEach(b=>{const x=v(t,b);x&&(y(x,t).forEach(A=>o.delete(A)),o.add(b))})}),o},[r,t,n]),l=p.useCallback(o=>i.has(o),[i]),m=p.useCallback(o=>{s(c=>{const d=new Set(c);return d.has(o)?d.delete(o):d.add(o),d})},[]);return{expandedIds:i,isExpanded:l,toggleExpanded:m,setExpandedIds:s}}function z({headings:t,setExpandedIds:r}){return p.useCallback(e=>{const n=document.getElementById(e);if(!n)return;n.scrollIntoView({behavior:"smooth",block:"start"});const s=encodeURIComponent(e);window.location.hash!==`#${s}`&&history.pushState(null,"",`#${s}`);const i=v(t,e);if(!i)return;const l=S(i);i.children.length>0&&l.unshift(e),l.length!==0&&r(m=>{const o=new Set(m),c={};return l.forEach(d=>{const a=v(t,d);a&&(c[a.level]||(c[a.level]=[]),c[a.level].push(d))}),Object.keys(c).forEach(d=>{const a=parseInt(d,10);c[a].forEach(f=>{const h=v(t,f);h&&(y(h,t).forEach(b=>o.delete(b)),o.add(f))})}),o})},[t,r])}const F=.75,N=1,j=({heading:t,depth:r=0,isActive:e=!1,isExpanded:n=!1,onHeadingClick:s,renderChildren:i})=>{const l=t.children.length>0;return g.jsxs("div",{className:"heading-tree-item relative",children:[g.jsxs("a",{href:`#${encodeURIComponent(t.id)}`,onClick:m=>{m.preventDefault(),s(t.id)},className:w("heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2",{"bg-primary/10 text-primary border-l-primary hover:text-primary hover:bg-primary/10 font-medium":e}),style:{paddingLeft:`${F+r*N}rem`,paddingRight:l?"0.5rem":"0.75rem"},"data-level":t.level,"aria-label":t.text,"aria-current":e?"location":void 0,children:[g.jsx("span",{className:"heading-text block flex-1 truncate leading-relaxed",children:t.text}),e&&g.jsx("span",{className:"text-primary ml-2 text-xs",children:"â€¢"})]}),l&&n&&i&&g.jsx("div",{className:"heading-children",children:i(t.children,r+1)})]},t.id)},E=p.memo(j),k=({headings:t,depth:r=0,activeId:e,expandedIds:n,onHeadingClick:s})=>{const i=(l,m)=>l.map(o=>g.jsx(E,{heading:o,depth:m,isActive:e===o.id,isExpanded:n.has(o.id),onHeadingClick:s,renderChildren:i},o.id));return g.jsx(g.Fragment,{children:t.map(l=>g.jsx(E,{heading:l,depth:r,isActive:e===l.id,isExpanded:n.has(l.id),onHeadingClick:s,renderChildren:i},l.id))})},_=p.memo(k);export{_ as H,$ as a,M as b,z as c,P as u};
